<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../../js/search_index.js" type="text/javascript"></script><script src="../../js/init.js" type="text/javascript"></script><title>Kernels   System|Numbat</title><script src="../../contrib/plotly/plotly.min.js" type="text/javascript"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../../media/github-logo.png" class="github-mark"></img><img src="../../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="fab1fe8f-d03a-45a4-aab6-c5f162e0675c">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="a49472eb-697a-459c-a57c-3fc9fd8828e7">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="7ff5b4fc-7666-45fa-8569-0e4b9610af36">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="ea0cbcd3-6dab-4901-9253-f5d4dad8f872">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="a15d1074-5cb7-44f4-b9a9-e96b95fda708">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="fab1fe8f-d03a-45a4-aab6-c5f162e0675c"><li><a href="../../getting_started.html">Installation</a></li></ul><ul class="dropdown-content" id="a49472eb-697a-459c-a57c-3fc9fd8828e7"><li><a href="../../introduction.html">Introduction</a></li><li><a href="../../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="7ff5b4fc-7666-45fa-8569-0e4b9610af36"><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../input_file_syntax.html">Input file syntax</a></li><li><a href="../../running_numbat.html">Running Numbat</a></li><li><a href="../../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="ea0cbcd3-6dab-4901-9253-f5d4dad8f872"><li><a href="../../example2D.html">2D</a></li><li><a href="../../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="a15d1074-5cb7-44f4-b9a9-e96b95fda708"><li><a href="../../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">syntax</a><a href="." class="breadcrumb">Kernels</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="Kernels   System" data-section-level="1" id="f4b7ac62-9ea6-4483-81fb-30102aeacb8d"><h1>Kernels System</h1><p>A "Kernel" is a piece of physics. It can represent one or more operators or terms in the weak form of a partial differential equation. With all terms on the left-hand-side, their sum is referred to as the "residual". The residual is evaluated at several integration quadrature points over the problem domain. To implement your own physics in MOOSE, you create your own kernel by subclassing the MOOSE <code>Kernel</code> class.</p><p>In a <code>Kernel</code> subclass the <code>computeQpResidual()</code> function <strong>must</strong> be overridden. This is where you implement your PDE weak form terms. The following member functions can optionally be overridden:</p><ul class="browser-default"><li><p><code>computeQpJacobian()</code> </p></li><li><p><code>computeQpOffDiagJacobian()</code></p></li></ul><p>These two functions provide extra information that can help the numerical solver(s) converge faster and better. Inside your Kernel class, you have access to several member variables for computing the residual and Jacobian values in the above mentioned functions:</p><ul class="browser-default"><li><p><code>_i</code>, <code>_j</code>: indices for the current test and trial shape functions respectively. </p></li><li><p><code>_qp</code>: current quadrature point index. </p></li><li><p><code>_u</code>, <code>_grad_u</code>: value and gradient of the variable this Kernel operates on; indexed by <code>_qp</code> (i.e. <code>_u[_qp]</code>). </p></li><li><p><code>_test</code>, <code>_grad_test</code>: value (<span class="moose-katex-inline-equation" id="moose-equation-8b176ec6-aa3c-4466-ab3d-269adc517cc8"><script>var element = document.getElementById("moose-equation-8b176ec6-aa3c-4466-ab3d-269adc517cc8");katex.render("\\psi", element, {displayMode:false,throwOnError:false});</script></span>) and gradient (<span class="moose-katex-inline-equation" id="moose-equation-f815d5da-ae92-4d4e-a705-7676417d1bd4"><script>var element = document.getElementById("moose-equation-f815d5da-ae92-4d4e-a705-7676417d1bd4");katex.render("\\nabla \\psi", element, {displayMode:false,throwOnError:false});</script></span>) of the test functions at the q-points; indexed by <code>_i</code> and then <code>_qp</code> (i.e., <code>_test[_i][_qp]</code>). </p></li><li><p><code>_phi</code>, <code>_grad_phi</code>: value (<span class="moose-katex-inline-equation" id="moose-equation-c796383c-6a7a-4616-8b73-375c91b0975d"><script>var element = document.getElementById("moose-equation-c796383c-6a7a-4616-8b73-375c91b0975d");katex.render("\\phi", element, {displayMode:false,throwOnError:false});</script></span>) and gradient (<span class="moose-katex-inline-equation" id="moose-equation-fd3815a4-0b66-4dc4-95e9-043c423b1cf3"><script>var element = document.getElementById("moose-equation-fd3815a4-0b66-4dc4-95e9-043c423b1cf3");katex.render("\\nabla \\phi", element, {displayMode:false,throwOnError:false});</script></span>) of the  trial functions at the q-points; indexed by <code>_j</code> and then <code>_qp</code> (i.e., <code>_phi[_j][_qp]</code>). </p></li><li><p><code>_q_point</code>: XYZ coordinates of the current quadrature point. </p></li><li><p><code>_current_elem</code>: pointer to the current element being operated on.</p></li></ul><section class="scrollspy" data-section-text="Custom   Kernel   Creation" data-section-level="2" id="613b38f6-eecf-473a-95bc-98ac94c62dbc"><h2>Custom Kernel Creation</h2><p>To create a custom kernel, you can follow the pattern of the <a data-position="top" href="../../source/kernels/Diffusion.html" class="tooltipped" data-tooltip="../../source/kernels/Diffusion.html"><code>Diffusion</code></a> kernel implemented and included in the MOOSE framework. Additionally, <a data-position="top" href="../../examples/custom_kernel.html" class="tooltipped" data-tooltip="../../examples/custom_kernel.html">Example 2</a> provides a step-by-step overview of creating your own custom kernel.</p><p>The strong-form of the diffusion equations is defined on a 3-D domain <span class="moose-katex-inline-equation" id="moose-equation-48d383f7-e592-4584-8277-c27c6aa6104b"><script>var element = document.getElementById("moose-equation-48d383f7-e592-4584-8277-c27c6aa6104b");katex.render("\\Omega", element, {displayMode:false,throwOnError:false});</script></span> as: find <span class="moose-katex-inline-equation" id="moose-equation-8b5d25e5-5d60-4fda-9f48-127e1461711b"><script>var element = document.getElementById("moose-equation-8b5d25e5-5d60-4fda-9f48-127e1461711b");katex.render("u", element, {displayMode:false,throwOnError:false});</script></span> such that</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-29a838e7-16b7-48a5-b81f-1ea240fcfc0e"></span><span class="moose-katex-equation-number">(1)</span><script>var element = document.getElementById("moose-equation-29a838e7-16b7-48a5-b81f-1ea240fcfc0e");katex.render("\ \\begin{aligned} -\\nabla\\cdot\\nabla u - f &= 0 \\in \\Omega\\\\ u|_{\\partial\\Omega_1} &= g_1\\\\ \\nabla u\\cdot \\hat{n} |_{\\partial\\Omega_2} &= g_2, \\end{aligned}", element, {displayMode:true,throwOnError:false});</script></span> where <span class="moose-katex-inline-equation" id="moose-equation-00197d93-501c-4082-8399-d84c17c05ca9"><script>var element = document.getElementById("moose-equation-00197d93-501c-4082-8399-d84c17c05ca9");katex.render("\\partial\\Omega_1", element, {displayMode:false,throwOnError:false});</script></span> is defined as the boundary on which the value of <span class="moose-katex-inline-equation" id="moose-equation-87270a85-1242-4355-94a0-9ba75e972a4e"><script>var element = document.getElementById("moose-equation-87270a85-1242-4355-94a0-9ba75e972a4e");katex.render("u", element, {displayMode:false,throwOnError:false});</script></span> is fixed to a known constant <span class="moose-katex-inline-equation" id="moose-equation-5f5c662a-0385-4b69-9073-7a6c81d2030e"><script>var element = document.getElementById("moose-equation-5f5c662a-0385-4b69-9073-7a6c81d2030e");katex.render("g_1", element, {displayMode:false,throwOnError:false});</script></span>, <span class="moose-katex-inline-equation" id="moose-equation-e5311b8e-82e1-4bd8-89a2-c0e27150a015"><script>var element = document.getElementById("moose-equation-e5311b8e-82e1-4bd8-89a2-c0e27150a015");katex.render("\\partial\\Omega_2", element, {displayMode:false,throwOnError:false});</script></span> is defined as the boundary on which the flux across the boundary is fixed to a known constant <span class="moose-katex-inline-equation" id="moose-equation-942ff9ed-6732-421a-bf80-1b5a5a11152b"><script>var element = document.getElementById("moose-equation-942ff9ed-6732-421a-bf80-1b5a5a11152b");katex.render("g_2", element, {displayMode:false,throwOnError:false});</script></span>, and $\hat{n} is the boundary outward normal.</p><p>The weak form is generated by multiplying by a test function (<span class="moose-katex-inline-equation" id="moose-equation-ecba2dc3-f6d6-4422-900d-35e176622d8d"><script>var element = document.getElementById("moose-equation-ecba2dc3-f6d6-4422-900d-35e176622d8d");katex.render("\\psi_i", element, {displayMode:false,throwOnError:false});</script></span>) and integrating over the domain (using inner-product notation):</p><p><span class="moose-katex-inline-equation" id="moose-equation-27b73bfc-c15e-4bba-ba7d-9bd0d286a889"><script>var element = document.getElementById("moose-equation-27b73bfc-c15e-4bba-ba7d-9bd0d286a889");katex.render("", element, {displayMode:false,throwOnError:false});</script></span> (-\nabla\cdot\nabla u_h, \psi_i) - (f, \psi_i) = 0\quad \forall\,\psi_i <span class="moose-katex-inline-equation" id="moose-equation-77f187f8-382c-421d-88ec-2dd3ec57dee7"><script>var element = document.getElementById("moose-equation-77f187f8-382c-421d-88ec-2dd3ec57dee7");katex.render("", element, {displayMode:false,throwOnError:false});</script></span> and then integrating by parts which gives the weak form:</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-e1d1e803-5a8f-41d5-bba1-196a1eed313e"></span><span class="moose-katex-equation-number">(2)</span><script>var element = document.getElementById("moose-equation-e1d1e803-5a8f-41d5-bba1-196a1eed313e");katex.render("\ (\\nabla u_h, \\nabla \\psi_i) - (f, \\psi_i) - \\langle g_2, \\psi_i\\rangle = 0\\quad \\forall\\,\\psi_i,", element, {displayMode:true,throwOnError:false});</script></span> where <span class="moose-katex-inline-equation" id="moose-equation-4d23040a-992a-4303-8774-90e206ca9284"><script>var element = document.getElementById("moose-equation-4d23040a-992a-4303-8774-90e206ca9284");katex.render("u_h", element, {displayMode:false,throwOnError:false});</script></span> is known as the trial function that defines the finite element discretization, <span class="moose-katex-inline-equation" id="moose-equation-89311900-5fcf-487c-9d7f-6cff42223678"><script>var element = document.getElementById("moose-equation-89311900-5fcf-487c-9d7f-6cff42223678");katex.render("u \\approx u_h = \\sum_{j=1}^N u_j \\phi_j", element, {displayMode:false,throwOnError:false});</script></span>, with <span class="moose-katex-inline-equation" id="moose-equation-0dddb9a5-e034-4fca-bfd0-884b2d55e4e8"><script>var element = document.getElementById("moose-equation-0dddb9a5-e034-4fca-bfd0-884b2d55e4e8");katex.render("\\phi_j", element, {displayMode:false,throwOnError:false});</script></span> being the basis functions.</p><p>The Jacobian, which is the derivative of <a class="tooltipped" href="#moose-equation-e1d1e803-5a8f-41d5-bba1-196a1eed313e" data-tooltip="#moose-equation-e1d1e803-5a8f-41d5-bba1-196a1eed313e" data-position="top">Eq. 2</a> with respect to <span class="moose-katex-inline-equation" id="moose-equation-5714af9d-9a1a-498c-8278-16885ecbb87d"><script>var element = document.getElementById("moose-equation-5714af9d-9a1a-498c-8278-16885ecbb87d");katex.render("u_j", element, {displayMode:false,throwOnError:false});</script></span> <span class="moose-katex-inline-equation" id="moose-equation-615ea6f2-0286-4e3e-a7a7-a3a163dc9787"><script>var element = document.getElementById("moose-equation-615ea6f2-0286-4e3e-a7a7-a3a163dc9787");katex.render("\\left(\\frac{\\partial (.)}{\\partial u_j}\\right)", element, {displayMode:false,throwOnError:false});</script></span>, is defined as:</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-813a4958-c116-4a6e-aa99-d3f861075167"></span><span class="moose-katex-equation-number">(3)</span><script>var element = document.getElementById("moose-equation-813a4958-c116-4a6e-aa99-d3f861075167");katex.render("(\\nabla \\phi_j, \\nabla \\psi_i)\\quad \\forall\\,\\psi_i", element, {displayMode:true,throwOnError:false});</script></span></p><p>The diffusion kernel header and implementation files are:</p><div class="card"><div class="card-content"><pre style="max-height:400px;"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#ifndef DIFFUSION_H
#define DIFFUSION_H

#include &quot;Kernel.h&quot;

class Diffusion;

template &lt;&gt;
InputParameters validParams&lt;Diffusion&gt;();

/**
 * This kernel implements the Laplacian operator:
 * $\nabla u \cdot \nabla \phi_i$
 */
class Diffusion : public Kernel
{
public:
  Diffusion(const InputParameters &amp; parameters);

protected:
  virtual Real computeQpResidual() override;

  virtual Real computeQpJacobian() override;
};

#endif /* DIFFUSION_H */</code></pre><a data-position="top" href="#87803c35-4daa-4077-978b-93a223801c03" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/framework/include/kernels/Diffusion.h">(../moose/framework/include/kernels/Diffusion.h)</a></div></div><div class="card"><div class="card-content"><pre style="max-height:400px;"><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;Diffusion.h&quot;

registerMooseObject(&quot;MooseApp&quot;, Diffusion);

template &lt;&gt;
InputParameters
validParams&lt;Diffusion&gt;()
{
  InputParameters params = validParams&lt;Kernel&gt;();
  params.addClassDescription(&quot;The Laplacian operator ($-\\nabla \\cdot \\nabla u$), with the weak &quot;
                             &quot;form of $(\\nabla \\phi_i, \\nabla u_h)$.&quot;);
  return params;
}

Diffusion::Diffusion(const InputParameters &amp; parameters) : Kernel(parameters) {}

Real
Diffusion::computeQpResidual()
{
  return _grad_u[_qp] * _grad_test[_i][_qp];
}

Real
Diffusion::computeQpJacobian()
{
  return _grad_phi[_j][_qp] * _grad_test[_i][_qp];
}</code></pre><a data-position="top" href="#d4ce3a2c-e719-41a4-9758-297dc430c26e" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/framework/src/kernels/Diffusion.C">(../moose/framework/src/kernels/Diffusion.C)</a></div></div><p>Before a custom physics kernel is available for use, it must be registered in your application. This is done in e.g. <code>src/base/YourApp.C</code> for the YourApp application.</p><pre><code class="language-cpp">
// src/base/YourApp.C contents

#include &quot;YourKernel.h&quot;

...

int YourApp::registerObjects(Factory &amp; factory)
{
  ...
  registerKernel(YourKernel);
  ...
}

...
</code></pre></section><section class="scrollspy" data-section-text="Time   Derivative   Kernels" data-section-level="2" id="fcd74ed7-88d5-4de6-ab5e-80afb2aa96fb"><h2>Time Derivative Kernels</h2><p>You can create a time-derivative term/kernel by subclassing <code>TimeKernel</code> instead of <code>Kernel</code>. For example, the residual contribution for a time derivative term is:</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-55e17b2e-be82-4a83-a2ab-ea23b761dec6"></span><span class="moose-katex-equation-number">(4)</span><script>var element = document.getElementById("moose-equation-55e17b2e-be82-4a83-a2ab-ea23b761dec6");katex.render("\\left(\\frac{\\partial u_h}{\\partial t}, \\psi_i\\right)", element, {displayMode:true,throwOnError:false});</script></span></p><p>where <span class="moose-katex-inline-equation" id="moose-equation-05360337-0f63-4c43-a077-0b8407da8990"><script>var element = document.getElementById("moose-equation-05360337-0f63-4c43-a077-0b8407da8990");katex.render("u_h", element, {displayMode:false,throwOnError:false});</script></span> is the finite element solution, and</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-b6a0efa4-f608-482c-abbf-bd02853a7eb3"></span><span class="moose-katex-equation-number">(5)</span><script>var element = document.getElementById("moose-equation-b6a0efa4-f608-482c-abbf-bd02853a7eb3");katex.render("\ \\frac{\\partial u_h}{\\partial t} \\equiv \\frac{\\partial}{\\partial t} \\left(     \\sum_k u_k \\phi_k \\right) = \\sum_k \\frac{\\partial u_k}{\\partial t} \\phi_k", element, {displayMode:true,throwOnError:false});</script></span></p><p>because you can interchange the order of differentiation and summation.</p><p>In the equation above, <span class="moose-katex-inline-equation" id="moose-equation-5215a96e-8d9f-4af8-ba3d-f1cfe5241240"><script>var element = document.getElementById("moose-equation-5215a96e-8d9f-4af8-ba3d-f1cfe5241240");katex.render("\\frac{\\partial u_k}{\\partial t}", element, {displayMode:false,throwOnError:false});</script></span> is the time derivative of the <span class="moose-katex-inline-equation" id="moose-equation-e240de6f-9951-41e2-94ec-24d0b9ac552e"><script>var element = document.getElementById("moose-equation-e240de6f-9951-41e2-94ec-24d0b9ac552e");katex.render("k", element, {displayMode:false,throwOnError:false});</script></span>th finite element coefficient of <span class="moose-katex-inline-equation" id="moose-equation-7b4cabbf-eb29-4fa4-83a9-0b25f8ca7743"><script>var element = document.getElementById("moose-equation-7b4cabbf-eb29-4fa4-83a9-0b25f8ca7743");katex.render("u_h", element, {displayMode:false,throwOnError:false});</script></span>. While the exact form of this derivative depends on the time stepping scheme, without much loss of generality, we can assume the following form for the time derivative:</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-e59861b3-3a84-4de8-bd6c-7df8615fea61"></span><span class="moose-katex-equation-number">(6)</span><script>var element = document.getElementById("moose-equation-e59861b3-3a84-4de8-bd6c-7df8615fea61");katex.render("\\frac{\\partial u_k}{\\partial t} = a u_k + b", element, {displayMode:true,throwOnError:false});</script></span></p><p>for some constants <span class="moose-katex-inline-equation" id="moose-equation-72eee9e5-b76c-4f43-92ef-6b75dab087d0"><script>var element = document.getElementById("moose-equation-72eee9e5-b76c-4f43-92ef-6b75dab087d0");katex.render("a", element, {displayMode:false,throwOnError:false});</script></span>, <span class="moose-katex-inline-equation" id="moose-equation-cb7ff702-3439-4fab-a664-157c8766caed"><script>var element = document.getElementById("moose-equation-cb7ff702-3439-4fab-a664-157c8766caed");katex.render("b", element, {displayMode:false,throwOnError:false});</script></span> which depend on <span class="moose-katex-inline-equation" id="moose-equation-287f35d9-3fde-4109-a811-026be7d1142b"><script>var element = document.getElementById("moose-equation-287f35d9-3fde-4109-a811-026be7d1142b");katex.render("\\Delta t", element, {displayMode:false,throwOnError:false});</script></span> and the timestepping method.</p><p>The derivative of equation <a class="tooltipped" href="#moose-equation-b6a0efa4-f608-482c-abbf-bd02853a7eb3" data-tooltip="#moose-equation-b6a0efa4-f608-482c-abbf-bd02853a7eb3" data-position="top">Eq. 5</a> with respect to <span class="moose-katex-inline-equation" id="moose-equation-c963e4a7-4ec7-4167-867f-9270e24e7bd9"><script>var element = document.getElementById("moose-equation-c963e4a7-4ec7-4167-867f-9270e24e7bd9");katex.render("u_j", element, {displayMode:false,throwOnError:false});</script></span> is then:</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-e3e22c1c-55a2-4cff-a170-97a2e7555f65"></span><span class="moose-katex-equation-number">(7)</span><script>var element = document.getElementById("moose-equation-e3e22c1c-55a2-4cff-a170-97a2e7555f65");katex.render("\\frac{\\partial}{\\partial u_j} \\left(     \\sum_k \\frac{\\partial u_k}{\\partial t} \\phi_k \\right) = \\frac{\\partial }{\\partial u_j} \\left(     \\sum_k (a u_k + b) \\phi_k \\right)  = a \\phi_j", element, {displayMode:true,throwOnError:false});</script></span></p><p>So that the Jacobian term for equation <a class="tooltipped" href="#moose-equation-b6a0efa4-f608-482c-abbf-bd02853a7eb3" data-tooltip="#moose-equation-b6a0efa4-f608-482c-abbf-bd02853a7eb3" data-position="top">Eq. 5</a> is</p><p><span class="moose-katex-block-equation"><span class="moose-katex-equation table-cell" id="moose-equation-f08d7ebd-5c45-4876-8943-c887b9e190bd"></span><span class="moose-katex-equation-number">(8)</span><script>var element = document.getElementById("moose-equation-f08d7ebd-5c45-4876-8943-c887b9e190bd");katex.render("\\left(a \\phi_j, \\psi_i\\right)", element, {displayMode:true,throwOnError:false});</script></span></p><p>where <span class="moose-katex-inline-equation" id="moose-equation-d7e87f90-b091-4400-ac73-270052b91664"><script>var element = document.getElementById("moose-equation-d7e87f90-b091-4400-ac73-270052b91664");katex.render("a", element, {displayMode:false,throwOnError:false});</script></span> is what we call <code>du_dot_du</code> in MOOSE.</p><p>Therefore the <code>computeQpResidual()</code> function for our time-derivative term kernel looks like:</p><p>text <code></code><code>cpp
return _test[_i][_qp] * _u_dot[_qp];
`</code>`</p><p>And the corresponding <code>computeQpJacobian()</code> is:</p><pre><code class="language-cpp">
return _test[_i][_qp] * _phi[_j][_qp] * _du_dot_du[_qp];
</code></pre></section><section class="scrollspy" data-section-text="Further   Kernel   Documentation" data-section-level="2" id="86fbd946-d37c-465d-a9dd-a01b70bc12e7"><h2>Further Kernel Documentation</h2><p>Several specialized kernel types exist in MOOSE each with useful functionality. Details for each are in the sections below.</p><ul class="collection with-header"><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatConvection.html" class="moose-syntax-objects-name">NumbatConvection</a><span class="moose-syntax-objects-description">Convection of concentration with velocity given by Darcy's law</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatConvectionSF.html" class="moose-syntax-objects-name">NumbatConvectionSF</a><span class="moose-syntax-objects-description">Convection of concentration with velocity given by Darcy's law using the streamfunction formulation</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatDarcy.html" class="moose-syntax-objects-name">NumbatDarcy</a><span class="moose-syntax-objects-description">Darcy's law</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatDarcySF.html" class="moose-syntax-objects-name">NumbatDarcySF</a><span class="moose-syntax-objects-description">Darcy's law for the streamfunction formulation</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatDiffusion.html" class="moose-syntax-objects-name">NumbatDiffusion</a><span class="moose-syntax-objects-description">Diffusion kernel with porosity</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatDiffusionSF.html" class="moose-syntax-objects-name">NumbatDiffusionSF</a><span class="moose-syntax-objects-description">Diffusion kernel for the streamfunction formulation</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NumbatTimeDerivative.html" class="moose-syntax-objects-name">NumbatTimeDerivative</a><span class="moose-syntax-objects-description">Time derivative kernel</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/AnisotropicDiffusion.html" class="moose-syntax-objects-name">AnisotropicDiffusion</a><span class="moose-syntax-objects-description">Anisotropic diffusion kernel <span class="moose-katex-inline-equation" id="moose-equation-07ecfb02-3418-4ad1-bacb-5549c2e9fad2"><script>var element = document.getElementById("moose-equation-07ecfb02-3418-4ad1-bacb-5549c2e9fad2");katex.render("\\nabla \\cdot -\\widetilde{k} \\nabla u", element, {displayMode:false,throwOnError:false});</script></span> with weak form given by <span class="moose-katex-inline-equation" id="moose-equation-75e753c3-a5c4-4dfc-af1d-c7cc48542e6a"><script>var element = document.getElementById("moose-equation-75e753c3-a5c4-4dfc-af1d-c7cc48542e6a");katex.render("(\\nabla \\psi_i, \\widetilde{k} \\nabla u)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/BodyForce.html" class="moose-syntax-objects-name">BodyForce</a><span class="moose-syntax-objects-description">Demonstrates the multiple ways that scalar values can be introduced into kernels, e.g. (controllable) constants, functions, and postprocessors. Implements the weak form <span class="moose-katex-inline-equation" id="moose-equation-044e5d35-42bb-4c24-8237-8b54a264895a"><script>var element = document.getElementById("moose-equation-044e5d35-42bb-4c24-8237-8b54a264895a");katex.render("(\\psi_i, -f)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/CoefTimeDerivative.html" class="moose-syntax-objects-name">CoefTimeDerivative</a><span class="moose-syntax-objects-description">The time derivative operator with the weak form of <span class="moose-katex-inline-equation" id="moose-equation-6bff594c-fe92-44b5-adea-30d5afa32e00"><script>var element = document.getElementById("moose-equation-6bff594c-fe92-44b5-adea-30d5afa32e00");katex.render("(\\psi_i, \\frac{\\partial u_h}{\\partial t})", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/ConservativeAdvection.html" class="moose-syntax-objects-name">ConservativeAdvection</a><span class="moose-syntax-objects-description">Conservative form of <span class="moose-katex-inline-equation" id="moose-equation-02206b2a-0acd-4a2f-b781-92e9deaf0ded"><script>var element = document.getElementById("moose-equation-02206b2a-0acd-4a2f-b781-92e9deaf0ded");katex.render("\\nabla \\cdot \\vec{v} u", element, {displayMode:false,throwOnError:false});</script></span> which in its weak form is given by: <span class="moose-katex-inline-equation" id="moose-equation-cd68d597-eac2-4a35-8ec9-af9d2a9467ae"><script>var element = document.getElementById("moose-equation-cd68d597-eac2-4a35-8ec9-af9d2a9467ae");katex.render("(-\\nabla \\psi_i, \\vec{v} u)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/CoupledForce.html" class="moose-syntax-objects-name">CoupledForce</a><span class="moose-syntax-objects-description">Implements a source term proportional to the value of a coupled variable. Weak form: <span class="moose-katex-inline-equation" id="moose-equation-a9cbab86-bc26-445a-8d5d-588608572303"><script>var element = document.getElementById("moose-equation-a9cbab86-bc26-445a-8d5d-588608572303");katex.render("(\\psi_i, -\\sigma v)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/CoupledTimeDerivative.html" class="moose-syntax-objects-name">CoupledTimeDerivative</a><span class="moose-syntax-objects-description">Time derivative Kernel that acts on a coupled variable. Weak form: <span class="moose-katex-inline-equation" id="moose-equation-c6f4a75c-0d4f-4936-ba3e-4c5ba0a5d5f5"><script>var element = document.getElementById("moose-equation-c6f4a75c-0d4f-4936-ba3e-4c5ba0a5d5f5");katex.render("(\\psi_i, \\frac{\\partial v_h}{\\partial t})", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/Diffusion.html" class="moose-syntax-objects-name">Diffusion</a><span class="moose-syntax-objects-description">The Laplacian operator (<span class="moose-katex-inline-equation" id="moose-equation-9fb0d20b-8116-46a5-8c3b-138cf5b44659"><script>var element = document.getElementById("moose-equation-9fb0d20b-8116-46a5-8c3b-138cf5b44659");katex.render("-\\nabla \\cdot \\nabla u", element, {displayMode:false,throwOnError:false});</script></span>), with the weak form of <span class="moose-katex-inline-equation" id="moose-equation-b564cb7e-ab0d-4004-a384-a9f45a11ac8f"><script>var element = document.getElementById("moose-equation-b564cb7e-ab0d-4004-a384-a9f45a11ac8f");katex.render("(\\nabla \\phi_i, \\nabla u_h)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/MassEigenKernel.html" class="moose-syntax-objects-name">MassEigenKernel</a><span class="moose-syntax-objects-description">An eigenkernel with weak form <span class="moose-katex-inline-equation" id="moose-equation-20e030ed-3c76-455b-b906-9207a146a138"><script>var element = document.getElementById("moose-equation-20e030ed-3c76-455b-b906-9207a146a138");katex.render("\\lambda(\\psi_i, -u_h)", element, {displayMode:false,throwOnError:false});</script></span> where <span class="moose-katex-inline-equation" id="moose-equation-b2b33b23-41b7-4cef-90e3-51cac30a8cb0"><script>var element = document.getElementById("moose-equation-b2b33b23-41b7-4cef-90e3-51cac30a8cb0");katex.render("\\lambda", element, {displayMode:false,throwOnError:false});</script></span> is the eigenvalue.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/MassLumpedTimeDerivative.html" class="moose-syntax-objects-name">MassLumpedTimeDerivative</a><span class="moose-syntax-objects-description">Lumped formulation of the time derivative <span class="moose-katex-inline-equation" id="moose-equation-dd6a44d3-d54a-4717-bdb9-fab0b5865e60"><script>var element = document.getElementById("moose-equation-dd6a44d3-d54a-4717-bdb9-fab0b5865e60");katex.render("\\frac{\\partial u}{\\partial t}", element, {displayMode:false,throwOnError:false});</script></span>. Its corresponding weak form is <span class="moose-katex-inline-equation" id="moose-equation-aa136519-eea9-449a-8587-8a00ed59f5b2"><script>var element = document.getElementById("moose-equation-aa136519-eea9-449a-8587-8a00ed59f5b2");katex.render("\\dot{u_i}(\\psi_i, 1)", element, {displayMode:false,throwOnError:false});</script></span> where <span class="moose-katex-inline-equation" id="moose-equation-dfd31a78-4e4f-4da8-bbb4-c08f5fc61701"><script>var element = document.getElementById("moose-equation-dfd31a78-4e4f-4da8-bbb4-c08f5fc61701");katex.render("\\dot{u_i}", element, {displayMode:false,throwOnError:false});</script></span> denotes the time derivative of the solution coefficient associated with node <span class="moose-katex-inline-equation" id="moose-equation-a72e5535-a628-446b-bf45-a723de701632"><script>var element = document.getElementById("moose-equation-a72e5535-a628-446b-bf45-a723de701632");katex.render("i", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/MaterialDerivativeRankFourTestKernel.html" class="moose-syntax-objects-name">MaterialDerivativeRankFourTestKernel</a><span class="moose-syntax-objects-description">Class used for testing derivatives of a rank four tensor material property.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/MaterialDerivativeRankTwoTestKernel.html" class="moose-syntax-objects-name">MaterialDerivativeRankTwoTestKernel</a><span class="moose-syntax-objects-description">Class used for testing derivatives of a rank two tensor material property.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/MaterialDerivativeTestKernel.html" class="moose-syntax-objects-name">MaterialDerivativeTestKernel</a><span class="moose-syntax-objects-description">Class used for testing derivatives of a scalar material property.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/NullKernel.html" class="moose-syntax-objects-name">NullKernel</a><span class="moose-syntax-objects-description">Kernel that sets a zero residual.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/Reaction.html" class="moose-syntax-objects-name">Reaction</a><span class="moose-syntax-objects-description">Implements a simple consuming reaction term with weak form <span class="moose-katex-inline-equation" id="moose-equation-5aa60334-3f7f-431c-ae8a-071b668659a8"><script>var element = document.getElementById("moose-equation-5aa60334-3f7f-431c-ae8a-071b668659a8");katex.render("(\\psi_i, u_h)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/TimeDerivative.html" class="moose-syntax-objects-name">TimeDerivative</a><span class="moose-syntax-objects-description">The time derivative operator with the weak form of <span class="moose-katex-inline-equation" id="moose-equation-607f09c0-ad58-40f4-990c-6825f68a272d"><script>var element = document.getElementById("moose-equation-607f09c0-ad58-40f4-990c-6825f68a272d");katex.render("(\\psi_i, \\frac{\\partial u_h}{\\partial t})", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/UserForcingFunction.html" class="moose-syntax-objects-name">UserForcingFunction</a><span class="moose-syntax-objects-description">Demonstrates the multiple ways that scalar values can be introduced into kernels, e.g. (controllable) constants, functions, and postprocessors. Implements the weak form <span class="moose-katex-inline-equation" id="moose-equation-a2f9179a-ce3e-4e46-8cb0-b8e76597bbd6"><script>var element = document.getElementById("moose-equation-a2f9179a-ce3e-4e46-8cb0-b8e76597bbd6");katex.render("(\\psi_i, -f)", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/VectorBodyForce.html" class="moose-syntax-objects-name">VectorBodyForce</a><span class="moose-syntax-objects-description">Demonstrates the multiple ways that scalar values can be introduced into kernels, e.g. (controllable) constants, functions, and postprocessors. Implements the weak form <span class="moose-katex-inline-equation" id="moose-equation-bfce5be1-8ff0-430f-a994-45df90e93ed6"><script>var element = document.getElementById("moose-equation-bfce5be1-8ff0-430f-a994-45df90e93ed6");katex.render("(\\vec{\\psi_i}, -\\vec{f})", element, {displayMode:false,throwOnError:false});</script></span>.</span></li><li class="moose-syntax-objects collection-item"><a href="../../source/kernels/VectorDiffusion.html" class="moose-syntax-objects-name">VectorDiffusion</a><span class="moose-syntax-objects-description">The Laplacian operator (<span class="moose-katex-inline-equation" id="moose-equation-90e347a4-5691-493c-a850-92afbd69cd67"><script>var element = document.getElementById("moose-equation-90e347a4-5691-493c-a850-92afbd69cd67");katex.render("-\\nabla \\cdot \\nabla \\vec{u}", element, {displayMode:false,throwOnError:false});</script></span>), with the weak form of <span class="moose-katex-inline-equation" id="moose-equation-8597b79c-c1b5-4fe6-b53c-9bac585d9825"><script>var element = document.getElementById("moose-equation-8597b79c-c1b5-4fe6-b53c-9bac585d9825");katex.render("(\\nabla \\vec{\\phi_i}, \\nabla \\vec{u_h})", element, {displayMode:false,throwOnError:false});</script></span>.</span></li></ul></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a data-delay="1000" data-position="left" href="#613b38f6-eecf-473a-95bc-98ac94c62dbc" class="tooltipped" data-tooltip="Custom   Kernel   Creation">Custom   Kernel   Creation</a></li><li><a data-delay="1000" data-position="left" href="#fcd74ed7-88d5-4de6-ab5e-80afb2aa96fb" class="tooltipped" data-tooltip="Time   Derivative   Kernels">Time   Derivative   Kernels</a></li><li><a data-delay="1000" data-position="left" href="#86fbd946-d37c-465d-a9dd-a01b70bc12e7" class="tooltipped" data-tooltip="Further   Kernel   Documentation">Further   Kernel   Documentation</a></li></ul></div></div></div></div></main></div><div id="87803c35-4daa-4077-978b-93a223801c03" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/framework/include/kernels/Diffusion.h</h4><pre><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#ifndef DIFFUSION_H
#define DIFFUSION_H

#include &quot;Kernel.h&quot;

class Diffusion;

template &lt;&gt;
InputParameters validParams&lt;Diffusion&gt;();

/**
 * This kernel implements the Laplacian operator:
 * $\nabla u \cdot \nabla \phi_i$
 */
class Diffusion : public Kernel
{
public:
  Diffusion(const InputParameters &amp; parameters);

protected:
  virtual Real computeQpResidual() override;

  virtual Real computeQpJacobian() override;
};

#endif /* DIFFUSION_H */
</code></pre></div></div><div id="d4ce3a2c-e719-41a4-9758-297dc430c26e" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/framework/src/kernels/Diffusion.C</h4><pre><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;Diffusion.h&quot;

registerMooseObject(&quot;MooseApp&quot;, Diffusion);

template &lt;&gt;
InputParameters
validParams&lt;Diffusion&gt;()
{
  InputParameters params = validParams&lt;Kernel&gt;();
  params.addClassDescription(&quot;The Laplacian operator ($-\\nabla \\cdot \\nabla u$), with the weak &quot;
                             &quot;form of $(\\nabla \\phi_i, \\nabla u_h)$.&quot;);
  return params;
}

Diffusion::Diffusion(const InputParameters &amp; parameters) : Kernel(parameters) {}

Real
Diffusion::computeQpResidual()
{
  return _grad_u[_qp] * _grad_test[_i][_qp];
}

Real
Diffusion::computeQpJacobian()
{
  return _grad_phi[_j][_qp] * _grad_test[_i][_qp];
}
</code></pre></div></div></body></html>