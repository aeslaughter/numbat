<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../../js/search_index.js" type="text/javascript"></script><script src="../../js/init.js" type="text/javascript"></script><title>IterationAdaptiveDT|Numbat</title><script src="../../contrib/plotly/plotly.min.js" type="text/javascript"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../../media/github-logo.png" class="github-mark"></img><img src="../../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="68b0eb07-e75b-44ed-b029-266f0e8fc116">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="14b097d6-e6ce-46b1-a90f-6307e354574c">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="b53e0bb0-3a00-4072-bbef-28c83bd1ad47">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="10f9d027-7c57-4662-a518-3e49997e589e">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="2c32a519-0be6-4376-b453-c4f310537d92">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="68b0eb07-e75b-44ed-b029-266f0e8fc116"><li><a href="../../getting_started.html">Installation</a></li><li><a href="../../contributing.html">Contributing</a></li></ul><ul class="dropdown-content" id="14b097d6-e6ce-46b1-a90f-6307e354574c"><li><a href="../../introduction.html">Introduction</a></li><li><a href="../../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="b53e0bb0-3a00-4072-bbef-28c83bd1ad47"><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../input_file_syntax.html">Input file syntax</a></li><li><a href="../../running_numbat.html">Running Numbat</a></li><li><a href="../../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="10f9d027-7c57-4662-a518-3e49997e589e"><li><a href="../../example2D.html">2D</a></li><li><a href="../../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="2c32a519-0be6-4376-b453-c4f310537d92"><li><a href="../../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href=".." class="breadcrumb">source</a><span class="breadcrumb">timesteppers</span><a href="IterationAdaptiveDT.html" class="breadcrumb">IterationAdaptiveDT</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="IterationAdaptiveDT" data-section-level="1" id="bf778c54-7c70-4778-958e-0d992e538f88"><h1>IterationAdaptiveDT</h1><p>Adjust the timestep based on the number of iterations</p><section class="scrollspy" data-section-text="Description" data-section-level="2" id="61eafc73-1786-443f-a498-aa87afd97460"><h2>Description</h2><p>The <code>IterationAdaptiveDT</code> Time Stepper provides a means to adapt the time step size based on the difficulty of the solution.</p><p><code>IterationAdaptiveDT</code> grows or shrinks the time step based on the number of iterations taken to obtain a converged solution in the last converged step. The required <code>optimal_iterations</code> parameter controls the number of nonlinear iterations per time step that provides optimal solution efficiency. If more iterations than that are required to obtain a converged solution, the time step may be too large, resulting in undue solution difficulty, while if fewer iterations are required, it may be possible to take larger time steps to obtain a solution more quickly.</p><p>A second parameter, <code>iteration_window</code>, is used to control the size of the region in which the time step is held constant. As shown in <a class="tooltipped" href="#fig:adaptive_dt_criteria" data-tooltip="#fig:adaptive_dt_criteria" data-position="top">Figure 1</a>, if the number of nonlinear iterations for convergence is lower than (<code>optimal_iterations-iteration_window</code>), the time step is increased, while if more than (<code>optimal_iterations+iteration_window</code>), iterations are required, the time step is decreased. The <code>iteration_window</code> parameter is optional. If it is not specified, it defaults to 1/5 the value specified for <code>optimal_iterations</code>.</p><p>The decision on whether to grow or shrink the time step is based both on the number of nonlinear iterations and the number of linear iterations. The parameters mentioned above are used to control the optimal iterations and window for nonlinear iterations. The same criterion is applied to the linear iterations. Another parameter, <code>linear_iteration</code> ratio, which defaults to 25, is used to control the optimal iterations and window for the linear iterations. These are calculated by multiplying <code>linear_iteration_ratio</code> by optimal iterations and iteration window, respectively.</p><p>To grow the time step, the growth criterion must be met for both the linear iterations and nonlinear iterations. If the time step shrinkage criterion is reached for either the linear or nonlinear iterations, the time step is decreased. To control the time step size only based on the number of nonlinear iterations, set <code>linear_iteration_ratio</code> to a large number.</p><p>If the time step is to be increased or decreased, that is done using the factors specified with the <code>growth_factor</code> and <code>cutback_factor</code>, respectively. If a solution fails to converge when adaptive time stepping is active, a new attempt is made using a smaller time step in the same manner as with the fixed time step methods. The maximum and minimum time steps can be optionally specified in the <code>Executioner</code> block using the <code>dtmax</code> and <code>dtmin</code> parameters, respectively.</p><p>In addition to controlling the time step based on the iteration count, <code>IterationAdaptiveDT</code> also has an option to limit the time step based on the behavior of a time-dependent function, optionall specified by providing the function name in <code>timestep_limiting_function</code>. This is typically a function that is used to drive boundary conditions of the model. The step is cut back if the change in the function from the previous step exceeds the value specified in <code>max_function_change</code>. This allows the step size to be changed to limit the change in the boundary conditions applied to the model over a step. In addition to that limit, the boolean parameter <code>force_step_every_function_point</code> can be set to <code>true</code> to force a time step at every point in a <code>PiecewiseLinear</code> function.</p><div style="width:70%;" id="fig:adaptive_dt_criteria" class="card"><div class="card-image"><img src="../../media/executioner/adaptive_dt_criteria.png" class="materialboxed moose-image"></img><p class="moose-caption"><span class="moose-caption-heading">Figure 1: </span><span class="moose-caption-text">Criteria used to determine adaptive time step size</span></p></div></div></section><section class="scrollspy" data-section-text="Example   Input   Syntax" data-section-level="2" id="360b1d76-f4c9-41b5-bdfa-f975da5ea5be"><h2>Example Input Syntax</h2><div class="card"><div class="card-content"><pre style="max-height:350px;"><code class="language-text">
[Executioner]
  type = Transient
  solve_type = NEWTON
  start_time = 0.0
  dtmin = 1.0
  end_time = 10.0
  [./TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 1
    linear_iteration_ratio = 1
    dt = 5.0
  [../]
[]</code></pre><a data-position="top" href="#b489d390-a2fd-41a2-86f2-3f8dc1842e0a" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/test/tests/time_steppers/iteration_adaptive/adapt_tstep_shrink_init_dt.i">(../moose/test/tests/time_steppers/iteration_adaptive/adapt_tstep_shrink_init_dt.i)</a></div></div></section><section class="scrollspy" data-section-text="Input   Parameters" data-section-level="2" id="e0c555c3-f0b6-46a4-9859-ff22d8788689"><h2>Input Parameters</h2><section data-details-open="open" data-section-text="Required Parameters" data-section-level="3" id="8afdf0dc-2962-4ad9-a935-3768ce07067d"><details open="open" class="moose-section-content"><ul data-collapsible="expandable" class="collapsible"><li><div class="collapsible-header"><span class="moose-parameter-name">dt</span><span class="moose-parameter-header-description">The default timestep size between solves</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description"><span>Description:</span>The default timestep size between solves</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Required Parameters</h3></summary></details></section><section data-details-open="open" data-section-text="Optional Parameters" data-section-level="3" id="fa713c28-03ad-4c8f-b72c-a763cd1cd436"><details open="open" class="moose-section-content"><ul data-collapsible="expandable" class="collapsible"><li><div class="collapsible-header"><span class="moose-parameter-name">reset_dt</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Use when restarting a calculation to force a change in dt.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description"><span>Description:</span>Use when restarting a calculation to force a change in dt.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">force_step_every_function_point</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">Forces the timestepper to take a step that is consistent with points defined in the function</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description"><span>Description:</span>Forces the timestepper to take a step that is consistent with points defined in the function</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">postprocessor_dtlim</span><span class="moose-parameter-header-description">If specified, the postprocessor value is used as an upper limit for the current time step length</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>PostprocessorName</p><p class="moose-parameter-description"><span>Description:</span>If specified, the postprocessor value is used as an upper limit for the current time step length</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">timestep_limiting_function</span><span class="moose-parameter-header-description">A 'PiecewiseBase' type function used to control the timestep by limiting the change in the function over a timestep</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>FunctionName</p><p class="moose-parameter-description"><span>Description:</span>A 'PiecewiseBase' type function used to control the timestep by limiting the change in the function over a timestep</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">linear_iteration_ratio</span><span class="moose-parameter-header-description">The ratio of linear to nonlinear iterations to determine target linear iterations and window for adaptive timestepping (default = 25)</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>unsigned int</p><p class="moose-parameter-description"><span>Description:</span>The ratio of linear to nonlinear iterations to determine target linear iterations and window for adaptive timestepping (default = 25)</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">time_t</span><span class="moose-parameter-header-description">The values of t</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector<double></p><p class="moose-parameter-description"><span>Description:</span>The values of t</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">reject_large_step_threshold</span><span class="moose-parameter-header-default">0.1</span><span class="moose-parameter-header-description">Ratio between the the ideal time step size and the current time step size below which a time step will be rejected if 'reject_large_step' is 'true'</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0.1</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description"><span>Description:</span>Ratio between the the ideal time step size and the current time step size below which a time step will be rejected if 'reject_large_step' is 'true'</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">reject_large_step</span><span class="moose-parameter-header-default">False</span><span class="moose-parameter-header-description">If 'true', time steps that are too large compared to the ideal time step will be rejected and repeated</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>False</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description"><span>Description:</span>If 'true', time steps that are too large compared to the ideal time step will be rejected and repeated</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">time_dt</span><span class="moose-parameter-header-description">The values of dt</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector<double></p><p class="moose-parameter-description"><span>Description:</span>The values of dt</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">cutback_factor</span><span class="moose-parameter-header-default">0.5</span><span class="moose-parameter-header-description">Factor to apply to timestep if difficult convergence (if 'optimal_iterations' is specified) or if solution failed</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>0.5</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description"><span>Description:</span>Factor to apply to timestep if difficult convergence (if 'optimal_iterations' is specified) or if solution failed</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">iteration_window</span><span class="moose-parameter-header-description">Attempt to grow/shrink timestep if the iteration count is below/above 'optimal_iterations plus/minus iteration_window' (default = optimal_iterations/5).</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>int</p><p class="moose-parameter-description"><span>Description:</span>Attempt to grow/shrink timestep if the iteration count is below/above 'optimal_iterations plus/minus iteration_window' (default = optimal_iterations/5).</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">optimal_iterations</span><span class="moose-parameter-header-description">The target number of nonlinear iterations for adaptive timestepping</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>int</p><p class="moose-parameter-description"><span>Description:</span>The target number of nonlinear iterations for adaptive timestepping</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">growth_factor</span><span class="moose-parameter-header-default">2</span><span class="moose-parameter-header-description">Factor to apply to timestep if easy convergence (if 'optimal_iterations' is specified) or if recovering from failed solve</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>2</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description"><span>Description:</span>Factor to apply to timestep if easy convergence (if 'optimal_iterations' is specified) or if recovering from failed solve</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">max_function_change</span><span class="moose-parameter-header-description">The absolute value of the maximum change in timestep_limiting_function over a timestep</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>double</p><p class="moose-parameter-description"><span>Description:</span>The absolute value of the maximum change in timestep_limiting_function over a timestep</p></div></li></ul><summary><h3 data-details-open="open"><span class="moose-section-icon"></span>Optional Parameters</h3></summary></details></section><section data-details-open="close" data-section-text="Advanced Parameters" data-section-level="3" id="8ba608d2-46a1-41d1-81d6-36f115bc2da4"><details class="moose-section-content"><ul data-collapsible="expandable" class="collapsible"><li><div class="collapsible-header"><span class="moose-parameter-name">control_tags</span><span class="moose-parameter-header-description">Adds user-defined labels for accessing object parameters via control logic.</span></div><div class="collapsible-body"><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>std::vector<std::string></p><p class="moose-parameter-description"><span>Description:</span>Adds user-defined labels for accessing object parameters via control logic.</p></div></li><li><div class="collapsible-header"><span class="moose-parameter-name">enable</span><span class="moose-parameter-header-default">True</span><span class="moose-parameter-header-description">Set the enabled status of the MooseObject.</span></div><div class="collapsible-body"><p class="moose-parameter-description-default"><span>Default:</span>True</p><p class="moose-parameter-description-cpptype"><span>C++ Type:</span>bool</p><p class="moose-parameter-description"><span>Description:</span>Set the enabled status of the MooseObject.</p></div></li></ul><summary><h3 data-details-open="close"><span class="moose-section-icon"></span>Advanced Parameters</h3></summary></details></section></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a data-delay="1000" data-position="left" href="#61eafc73-1786-443f-a498-aa87afd97460" class="tooltipped" data-tooltip="Description">Description</a></li><li><a data-delay="1000" data-position="left" href="#360b1d76-f4c9-41b5-bdfa-f975da5ea5be" class="tooltipped" data-tooltip="Example   Input   Syntax">Example   Input   Syntax</a></li><li><a data-delay="1000" data-position="left" href="#e0c555c3-f0b6-46a4-9859-ff22d8788689" class="tooltipped" data-tooltip="Input   Parameters">Input   Parameters</a></li></ul></div></div></div></div></main></div><div id="b489d390-a2fd-41a2-86f2-3f8dc1842e0a" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/test/tests/time_steppers/iteration_adaptive/adapt_tstep_shrink_init_dt.i</h4><pre><code class="language-text">[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 50
  ny = 2
  xmax = 5
[]

[Variables]
  [./u]
    order = FIRST
    family = LAGRANGE
  [../]
[]

[Kernels]
  [./diff]
    type = Diffusion
    variable = u
  [../]
  [./dt]
    type = TimeDerivative
    variable = u
  [../]
[]

[BCs]
  [./left]
    type = DirichletBC
    variable = u
    boundary = left
    value = 10
  [../]
  [./right]
    type = NeumannBC
    variable = u
    boundary = right
    value = -1
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON
  start_time = 0.0
  dtmin = 1.0
  end_time = 10.0
  [./TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 1
    linear_iteration_ratio = 1
    dt = 5.0
  [../]
[]

[Postprocessors]
  [./_dt]
    type = TimestepSize
  [../]
[]

[Outputs]
  execute_on = 'timestep_end'
  exodus = true
  checkpoint = true
[]
</code></pre></div></div></body></html>