<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../js/search_index.js" type="text/javascript"></script><script src="../js/init.js" type="text/javascript"></script><title>Debugging|Numbat</title><script src="../contrib/plotly/plotly.min.js" type="text/javascript"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../media/github-logo.png" class="github-mark"></img><img src="../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="a19cd35d-0483-46ae-95bf-3e60a42dd08b">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="d8213ebb-b186-4289-b651-207eb608692f">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="5ec5bc16-415f-4384-ac32-f41e84b6314a">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="af208f73-cf36-4ec4-89ea-14bae2cde4c4">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="5187f15e-bfa5-485e-a0a8-ba82d1a0f65b">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="a19cd35d-0483-46ae-95bf-3e60a42dd08b"><li><a href="../getting_started.html">Installation</a></li></ul><ul class="dropdown-content" id="d8213ebb-b186-4289-b651-207eb608692f"><li><a href="../introduction.html">Introduction</a></li><li><a href="../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="5ec5bc16-415f-4384-ac32-f41e84b6314a"><li><a href="../implementation.html">Implementation</a></li><li><a href="../input_file_syntax.html">Input file syntax</a></li><li><a href="../running_numbat.html">Running Numbat</a></li><li><a href="../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="af208f73-cf36-4ec4-89ea-14bae2cde4c4"><li><a href="../example2D.html">2D</a></li><li><a href="../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="5187f15e-bfa5-485e-a0a8-ba82d1a0f65b"><li><a href="../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href="." class="breadcrumb">application_development</a><a href="debugging.html" class="breadcrumb">debugging</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="Debugging" data-section-level="1" id="cc6bf67e-0813-4f3b-8c63-9ad9fd8b351a"><h1>Debugging</h1><p>At some point while developing a MOOSE-based application you will probably need to use a debugger. A debugger will allow you to stop your program at certain points (or if things happen such as a memory segfault). Once stopped you can then carefully step through the program, inspecting variable values as you go in order to find the source of the problem.</p><p>In particular, if you ever see a "Segfault" or a "Signal 11" that means it's time to pull out the debugger. Any debugger will automatically stop once a segfault is reached, showing you exactly where the invalid memory access occurred.</p><p>For a good tutorial on debugging <a data-position="top" href="../examples/ex21_debugging.html" class="tooltipped" data-tooltip="../examples/ex21_debugging.html">see Example 21</a></p><section class="scrollspy" data-section-text="Debug   Executable" data-section-level="2" id="5973e217-7e1e-449f-8d40-c66098c38ca6"><h2>Debug Executable</h2><p>The first step to debugging anything is to build a debug executable. By default MOOSE-based applications are built in "optimized" (<code>opt</code>) mode. That ensures the fastest solves. However, an optimized executable is missing a lot of information that is useful to a debugger and the optimization process itself can cause code to get reordered (or even skipped!) making it difficult to step through a program.</p><p>To build an executable suitable for debugging you need to set the <code>METHOD</code> environment variable to <code>dbg</code>. You can <code>export</code> it in your environment but it's usually simpler to use a UNIX shortcut that allows you to define environment variables at the same time you run a command, like so:</p><pre><code class="language-bash">
METHOD=dbg make -j 8
</code></pre><p>Always remember that the <code>8</code> should be modified to reflect the number of processors you want to use for the build (usually the number of cores in your computer).</p><p>Once the build is complete you should end up with a "debug executable" that look like: <code>yourapp-dbg</code>. That executable is perfect for loading into a debugger. However, that executable will run VERY slowly - so make sure that before you begin debugging you come up with a problem that is as small as possible but still shows the problem you're trying to fix.</p></section><section class="scrollspy" data-section-text="Debuggers" data-section-level="2" id="2bbfb6bf-2b54-43d3-b870-2bc2ed127743"><h2>Debuggers</h2><p>Many different debuggers exist: <code>lldb</code>, <code>gdb</code>, <code>ddd</code>, Totalview and Intel Debugger are just a few. While a command-line debugger (like <code>lldb</code> or <code>gdb</code>) might seem daunting at first, they are an invaluable tool for quick debugging and debugging in complicated scenarios such as when you're running on a cluster. Learning one should be essential to any computational scientist.</p><p>For debugging MOOSE-based applications we recommend <code>lldb</code> if you're using the clang compiler (default on Mac OSX) and <code>gdb</code> for the <code>gcc</code> compiler (default on Linux).</p><section data-section-text="LLDB   and   GDB" data-section-level="3" id="cde57e1b-ac00-44d0-bdac-77c5dc639141"><h3>LLDB and GDB</h3><p><code>lldb</code> and <code>gdb</code> are very similar. They work on the "command-line" taking text input and moving through your program as it executes.</p><p>With our MOOSE package on Mac OSX you actually need to run lldb using <code>sudo</code> so it has the elevated privileges it needs to attach to your program. To invoke <code>lldb</code> with a MOOSE-based application on Mac OSX you would do:</p><pre><code class="language-bash">
sudo lldb -- ./yourapp-dbg -i inputfile.i
</code></pre><p>The <code>--</code> tells lldb that any command-line options after that point need to be passed to the executable you are running. <code>sudo</code> will ask you for your password so that it can elevate the priveleges of <code>lldb</code>. You can also look below to see how to allow <code>lldb</code> to run with sudo without using a password.</p><p><code>gdb</code> can be run with a similar command:</p><pre><code class="language-bash">
gdb --args ./yourapp-dbg -i inputfile.i
</code></pre><p>(On Linux this will generally work, without the need for <code>sudo</code>)</p><p>Once this is done, your executable will be loaded but won't start running. This is an opportune time to set breakpoints. We usually recommmend setting a breakpoint on <code>MPI_Abort</code> using the <code>b</code> command:</p><pre><code class="language-text">
b MPI_Abort
</code></pre><p>Then to start running your executable use the <code>r</code> command (type <code>r</code> then hit enter).</p><p>If a breakpoint (or fault) is reached: I recommend first using the <code>bt</code> command to output a "back-trace" so you can see exactly what the current call-stack looks like to figure out where you are.</p><p>To quit the debugger use <code>Ctrl+d</code> (by the way: that's a normal way to quit lots of command-line interpreters on Unix - including Python).</p><p>Another useful command is <code>p</code> (for 'print') which allows you to print out the value of a variable. Just do:</p><pre><code class="language-text">
p variablename
</code></pre><p>You can learn about the full set of commands by using <code>help</code> or looking at any number of tutorials online.</p></section></section><section class="scrollspy" data-section-text="Parallel   Debugging" data-section-level="2" id="a39f82a0-d36f-451a-a1b5-c9fbd370552d"><h2>Parallel Debugging</h2><p>Firstly, if you don't have to debug in parallel <em>DON'T</em>! Only do parallel debugging when you have a problem that can only be reproduced when running in parallel. If your problem will show up in serial, it is MUCH easier to debug in serial. If it takes a long time for your problem to run so you are wanting to run it in parallel: don't do that... instead, try to make your problem smaller so that you can debug it in serial.</p><p>With all of that said: if you actually do need to debug in parallel, MOOSE has a couple of command-line arguments to help. However, before we get there, we need to do a bit of setup on Mac OSX:</p><section data-section-text="Mac   OSX   Parallel   Debugging   Setup" data-section-level="3" id="297142ab-49f0-4f4f-b7a1-08408d1aae49"><h3>Mac OSX Parallel Debugging Setup</h3><p>As noted above, when running <code>lldb</code> on Mac OSX we need to run with <code>sudo</code> to give it permission to attach to our running program. <code>sudo</code> will ask for your password, but unfortunately when doing parallel debugging there is no way to enter that password. Therefore, we need to make it so that you can run <code>lldb</code> with <code>sudo</code> without a password.</p><p>First thing is to get the full path to where <code>lldb</code> is using the command-line:</p><pre><code class="language-bash">
which lldb
</code></pre><p>If you are using our package on OSX this should return something like <code>/opt/moose/llvm-5.0.1/bin/lldb</code>. Make note of this location (copy it, or set that Terminal aside) because you'll need it in the next step.</p><p>To set <code>lldb</code> to be able to run with <code>sudo</code> without a password we need to modify the <code>sudoers</code> file. To do that issue this command in a terminal (preferably a new one so you can still see the path to <code>lldb</code> in the first one):</p><pre><code class="language-bash">
sudo visudo
</code></pre><p>Most-likely this is going to use <code>vi</code> (a text editor) to open the <code>sudoers</code> file (I say "most-likely" because it technically can open any editor based on the <code>EDITOR</code> environment variable). If you are unfamiliar with <code>vi</code> don't worry. Just press <code>i</code> to go into "insert" mode. Navigate to the bottom of the file and add a line that looks like:</p><pre><code class="language-text">
username ALL= NOPASSWD: /opt/moose/llvm-5.0.1/bin/lldb
</code></pre><p>Where <code>username</code> MUST be replaced with <em>your</em> username! And the path to <code>lldb</code> needs to reflect what you got back from <code>which lldb</code> above. Once that line is in place press <code>Esc</code> (to exit "insert mode") then type <code>:wq</code> (that's a <code>colon</code> then <code>w</code> then <code>q</code> - it's a command that says "write and quit") and press <code>Enter</code>.</p><p>Once you've completed that you should be able to run <code>sudo lldb</code> on the command-line and not need to enter your password. If you still need to enter your password, email <code>moose-users</code> so we can figure out what's wrong before you go further.</p></section><section data-section-text="Actually   Parallel   Debugging" data-section-level="3" id="8e194a19-4426-4edc-85b8-0f8dcfdad52e"><h3>Actually Parallel Debugging</h3><p>With all of that setup we are ready to debug in parallel. There are two options:</p><section data-section-text="1 .   Launch   a   terminal   for   each   MPI   process" data-section-level="4" id="f0eb84f4-a2ba-4492-8d8b-a95a5481f552"><h4>1. Launch a terminal for each MPI process</h4><p>What we're going to do is launch a terminal (using <code>xterm</code>) for each MPI process. That terminal will run our debugger and attach to the running MPI process. For this to work, you either need to be on your local box or have X-forwarding set up over SSH (which I'm not going to go into here).</p><p>Let's assume that you're working on your local Mac workstation using our package. In order to launch your program with 4 MPI processes and 4 terminals for debugging you would do:</p><pre><code class="language-bash">
mpiexec -n 4 ./yourapp-dbg -i inputfile.i --start-in-debugger='sudo lldb'
</code></pre><p>(If you are on Linux - most-likely you will want to put <code>gdb</code> where <code>sudo lldb</code> is)</p><p>If everything is setup correctly you should see 4 XTerm windows show up with <code>lldb</code> command-line prompts. Those debugger prompts are already attached to your running executable, but the executable is paused. This is an opportune time to set breakpoints, but you have to do it in each terminal seperately. For instance, you might want to go through each one and do:</p><pre><code class="language-text">
b MPI_Abort
</code></pre><p>to be able to stop if MOOSE encounters an error.</p><p>Once you are ready to <em>continue</em> - you do just that. Use the <code>c</code> command (type <code>c</code> and hit <code>Enter</code>) in each terminal window to tell it to continue. Once you go through all of the open terminal windows you should see your application start to run in your original terminal. If a breakpoint (or any fault) is reached on any process that terminal window will show the command-prompt again, allowing you to inspect variables, etc.</p><section data-section-text="Passing   debugger   commands   on   the   command   line" data-section-level="5" id="3862e4ca-e267-4311-a824-8a2112b19513"><h5>Passing debugger commands on the command line</h5><p><code>lldb</code> accepts debugger commands through the <code>-o</code> command line option that are executed as soon as the execuatble is loaded up and ready. This can be used to set breakpoints and immediately resume the execution of the app.</p><pre><code class="language-bash">
mpirun -n 4 ./yourapp-dbg -i inputfile.i --start-in-debugger &quot;sudo lldb -o 'break set -E C++' -o cont&quot;
</code></pre><p>The above command will set breakpoints that halt on thrown exceptions. Replace <code>break set -E C++</code> with <code>b MPI_Abort</code> to break on MOOSE errors. The <code>-o cont</code> option will automatically run the app after the breakpoints are set.</p></section></section><section data-section-text="2 .   Launch   your   application   and   tell   it   to   wait   so   you   can   manually   attach   a   debugger" data-section-level="4" id="a746d73e-6857-4a9a-8287-c3d3792f15c2"><h4>2. Launch your application and tell it to wait so you can manually attach a debugger</h4><p>This is going to be used in cases where you need to debug using LOTS of MPI processes, but you don't want a terminal window for each one. This is also handy if you're working on a cluster that doesn't have any way of doing X-forwarding for option #1 to work. The idea is to launch your application and have it wait during the initialization phase so you have time to attach a debugger manually to one of the processes.</p><p>To do this simply run your application like so:</p><pre><code class="language-bash">
mpiexec -n 4 ./yourapp-dbg -i inputfile.i --stop-for-debugger
</code></pre><p>This will cause your application to print something like the following and then wait 30 seconds (by default - if you need more time use <code>--stop-for-debugger=75</code> where <code>75</code> is the number of seconds you want it to wait):</p><pre><code class="language-text">
&gt; mpiexec -n 4 ../../../moose_test-opt -i simple_diffusion.i --stop-for-debugger=2

Stopping for 2 seconds to allow attachment from a debugger.

All of the processes you can connect to:
rank - hostname - pid
0 - dereksmacpro.local - 53403
1 - dereksmacpro.local - 53404
2 - dereksmacpro.local - 53405
3 - dereksmacpro.local - 53406

Waiting...
</code></pre><p>The message there is telling you where each process is running and what its "process ID" (<code>pid</code>) is. That is the relevant information you need to be able to attach a debugger to that process. In this case (on my local Mac) if I want to connect to "rank 2", in a separate Terminal I would do:</p><pre><code class="language-text">
sudo lldb -p 53405
</code></pre><p>(<code>gdb</code> has a similar mechanism, see its docs)</p><p>That will launch <code>lldb</code> and attach to my running program. Attaching to the program "pauses" it - allowing me to set breakpoints and then use the <code>c</code> command to tell it to continue. </p></section></section></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a data-delay="1000" data-position="left" href="#5973e217-7e1e-449f-8d40-c66098c38ca6" class="tooltipped" data-tooltip="Debug   Executable">Debug   Executable</a></li><li><a data-delay="1000" data-position="left" href="#2bbfb6bf-2b54-43d3-b870-2bc2ed127743" class="tooltipped" data-tooltip="Debuggers">Debuggers</a></li><li><a data-delay="1000" data-position="left" href="#a39f82a0-d36f-451a-a1b5-c9fbd370552d" class="tooltipped" data-tooltip="Parallel   Debugging">Parallel   Debugging</a></li></ul></div></div></div></div></main></div></body></html>