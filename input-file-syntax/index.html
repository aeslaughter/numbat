<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Chris Green">
  
  <title>Syntax - Numbat</title>
  

  <link rel="shortcut icon" href="../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  <link href="../css/extra.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Syntax";
    var mkdocs_page_input_path = "input-file-syntax.md";
    var mkdocs_page_url = "/input-file-syntax/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script>
  <script src="../js/theme.js"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML"></script>
  <script src="../js/mathjaxhelper.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Numbat</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="..">Overview</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../getting-started/">Getting started</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../governing-equations/">Theory</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 current">
        <a class="current" href="./">Syntax</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#input-file-syntax">Input file syntax</a></li>
                
                    <li><a class="toctree-l4" href="#essential-input">Essential input</a></li>
                
                    <li><a class="toctree-l4" href="#optional-input">Optional input</a></li>
                
            
            </ul>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Examples</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../example2D/">2D example</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../example3D/">3D example</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../references/">References</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../download/">Download PDF</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Numbat</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
    
    <li>Syntax</li>
    <li class="wy-breadcrumbs-aside">
      
        
          <a href="https://github.com/cpgr/numbat/" class="icon icon-github"> Edit on GitHub</a>
        
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="input-file-syntax">Input file syntax</h1>
<p>The input file for a Numbat simulation is a simple, block-structured
text file.</p>
<p>A working example of a 2D problem can be found at
<a href="https://github.com/cpgr/numbat/blob/master/examples/2D/2Dddc.i">https://github.com/cpgr/numbat/blob/master/examples/2D/2Dddc.i</a></p>
<p>A working example of a 3D problem can be found at
<a href="https://github.com/cpgr/numbat/blob/master/examples/3D/3Dddc.i">https://github.com/cpgr/numbat/blob/master/examples/3D/3Dddc.i</a></p>
<h2 id="essential-input">Essential input</h2>
<p>Details of the minimum input file requirements are given below.</p>
<h3 id="mesh">Mesh</h3>
<p>All simulations must feature a mesh. For the basic model with a
rectangular mesh, the built-in MOOSE <em>GeneratedMesh</em> can be used to
create a suitable mesh. In 2D, the input block looks like:</p>
<pre><code>[Mesh]
  type = GeneratedMesh
  dim = 2
  xmax = 1000
  ymin = -200
  ymax = 0
  nx = 80
  ny = 20
  bias_y = 0.7
[]
</code></pre>
<p>This creates a 2D mesh from $x = 0$ to $x = 1000$ and $y = -200$ to
$y = 0$ with 80 elements in the $x$-direction and 20 elements in the
$y$-direction. It is useful to have a mesh that is more refined at the
top of the model, to accurately capture the initially small structure of
the convective fingers. This is achieved using the built-in <em>bias_y</em>
parameter.</p>
<p>In 3D, the Mesh block would look like:</p>
<pre><code>[Mesh]
  type = GeneratedMesh
  dim = 3
  xmax = 200
  ymax = 200
  zmin = -200
  zmax = 0
  nx = 10
  ny = 10
  nz = 10
  bias_z = 0.7
[]
</code></pre>
<p>Again, the mesh is refined at the top of the model using the the
<em>bias_z</em> parameter.</p>
<h3 id="variables">Variables</h3>
<p>For a 2D model, the simulation must have two variables: <em>concentration</em>
and <em>streamfunction</em>. This can be implemented in the input file using
the following code:</p>
<pre><code>[Variables]
[./concentration]
order = FIRST
family = LAGRANGE
  [./InitialCondition]
    type = NumbatPerturbationIC
    variable = concentration
    amplitude = 0.01
    seed = 1
  [../]
[../]
[./streamfunction]
  order = FIRST
  family = LAGRANGE
  initial_condition = 0.0
[../]
[]
</code></pre>
<p>Initial conditions can also be specified in the <em>Variables</em> block. In
this case, the initial concentration is perturbed using a
<em>NumbatPerturbationIC</em> to seed the instability.</p>
<p>For a 3D model, three variables are required: one <em>concentration</em>
variable and two <em>streamfunction</em> variables corresponding to the <em>x</em> and
<em>y</em> components. This can be implemented in the input file using:</p>
<pre><code>[Variables]  
  [./concentration]  
  [../]  
  [./streamfunctionx]  
  [../]  
  [./streamfunctiony]  
  [../]  
[]
</code></pre>
<h3 id="kernels">Kernels</h3>
<p>Three kernels are required for a 2D model: a <em>NumbatDarcySF</em> kernel for the
<em>streamfunction</em> variable, a <em>NumbatConvectionDiffusionSF</em> kernel for the
<em>concentration</em> variable, and a <em>TimeDerivative</em> kernel also for the
<em>concentration</em> variable. An example for an isotropic model is</p>
<pre><code>[Kernels]
  [./Darcy]
    type = NumbatDarcySF
    variable = streamfunction
    concentration_variable = concentration
  [../]
  [./ConvectionDiffusion]
    type = NumbatConvectionDiffusionSF
    variable = concentration
    streamfunction_variable = streamfunction
    coeff_tensor = '1 0 0 0 1 0 0 0 1'
  [../]
  [./TimeDerivative]
    type = TimeDerivative
    variable = concentration
  [../]
[]
</code></pre>
<p>The <em>coeff_tensor</em> parameter in each convective diffusion kernel can be
modified. The format of this</p>
<p>For 3D models, an additional <em>NumbatDarcySF</em> kernel is required for the
additional stream function variable. An example of the kernels block for
a 3D isotropic model is</p>
<pre><code>[Kernels]
  [./Darcy]
    type = NumbatDarcySF
    variable = streamfunctionx
    concentration_variable = concentration
    component = x
  [../]
  [./Darcy]
    type = NumbatDarcySF
    variable = streamfunctiony
    concentration_variable = concentration
    component = y
  [../]
  [./ConvectionDiffusion]
    type = NumbatConvectionDiffusionSF
    variable = concentration
    streamfunction_variable = 'streamfunctionx streamfunctiony'
    coeff_tensor = '1 0 0 0 1 0 0 0 1'
  [../]
  [./TimeDerivative]
    type = TimeDerivative
    variable = concentration
  [../]
[]
</code></pre>
<p>In the 3D case, it is important to note that the <em>NumbatDarcySF</em> kernel must
specify the component that it applies to, and that the
<em>streamfunction_variable</em> keyword in the <em>NumbatConvectionDiffusionSF</em>
kernel must contain both <em>streamfunction</em> variables ordered by the <em>x</em>
component then the <em>y</em> component.</p>
<h3 id="initial-condition">Initial condition</h3>
<p>To seed the instability, a random perturbation to the initial concentration is prescribed using the <em>NumbatPerturbationIC</em> initial condition. This can be applied in the <em>Variables</em> block in the input file (see above) using</p>
<pre><code>[./InitialCondition]
  type = NumbatPerturbationIC
  variable = concentration
  amplitude = 0.01
  seed = 1
[../]
</code></pre>
<p>The <em>NumbatPerturbationIC</em> initial condition applies the diffusive concentration profile to the nodes for (scaled) time $t = 1$,
\begin{equation}
c_d(z, t =1) = 1 + \mathrm{erf}(z /2),
\end{equation}
for $z &lt; 0$, where $\mathrm{erf(z)}$ is the error function.</p>
<p>A uniform random perturbation is then added to the diffusive concentration profile, where the amplitude of the perturbation is specified by the input file value <em>amplitude</em>.</p>
<h3 id="boundary-conditions">Boundary conditions</h3>
<p>Appropriate boundary conditions must be prescribed. Typically, these
will be constant concentration at the top of the model domain, periodic
boundary conditions on the lateral sides (to mimic an infinite
reservoir), and no-flow boundary conditions at the top and bottom
surfaces.</p>
<p>In 2D, this can be achieved using the following input block:</p>
<pre><code>[BCs]
  [./conctop]
    type = DirichletBC
    variable = concentration
    boundary = top
    value = 1.0
  [../]
  [./streamfuntop]
    type = DirichletBC
    variable = streamfunction
    boundary = top
    value = 0.0
  [../]
  [./streamfunbottom]
    type = DirichletBC
    variable = streamfunction
    boundary = bottom
    value = 0.0
  [../]
  [./periodic]
    [./x]
      variable = 'concentration streamfunction'
      auto_direction = x
    [../]
  [../]
[]
</code></pre>
<p>In this case, the <em>conctop</em> boundary condition is a Dirichlet condition
at the top of the model that fixes the value of concentration to unity.
It is useful to note that a MOOSE <em>GeneratedMesh</em> provides descriptive
names for the sides of the model (top, bottom, left, right) which can be
referenced in the input file. No-flow boundary conditions are prescribed
on the top and bottom surfaces by holding the <em>streamfunction</em> variable
constant (in this case 0). Finally, periodic boundary conditions are
applied by the <em>periodic</em> block, which specifies that both the
<em>concentration</em> and <em>streamfunction</em> variables are periodic on
boundaries in the $x$-direction.</p>
<p>A similar boundary condition block is used in 3D, except that no-flow
boundaries must be imposed on both streamfunction variables, see below:</p>
<pre><code>[BCs]
  [./conctop]
    type = DirichletBC
    variable = concentration
    boundary = front
    value = 1.0
  [../]
  [./streamfunxtop]
    type = DirichletBC
    variable = streamfunctionx
    boundary = front
    value = 0.0
  [../]
  [./streamfunxbottom]
    type = DirichletBC
    variable = streamfunctionx
    boundary = back
    value = 0.0
  [../]
  [./streamfunytop]
    type = DirichletBC
    variable = streamfunctiony
    boundary = front
    value = 0.0
  [../]
  [./streamfunybottom]
    type = DirichletBC
    variable = streamfunctiony
    boundary = back
    value = 0.0
  [../]
  [./Periodic]
    [./xy]
      variable = 'concentration streamfunctionx streamfunctiony'
      auto_direction = 'x y'
    [../]
  [../]
[]
</code></pre>
<h3 id="executioner">Executioner</h3>
<p>Each MOOSE simulation must use an <em>Executioner</em>, which provides
parameters for the solve. In both 2D and 3D models, a transient
<em>Executioner</em> is used, an example of which is presented below:</p>
<pre><code>[Executioner]
  type = Transient
  scheme = bdf2
  dtmin = 0.1
  dtmax = 200
  end_time = 2000
  solve_type = PJFNK
  petsc_options_iname = '-ksp_type -pc_type -pc_sub_type'
  petsc_options_value = 'gmres asm ilu'
  [./TimeStepper]
    type = IterationAdaptiveDT
    dt = 1
    cutback_factor = 0.5
    growth_factor = 2
  [../]
[]
</code></pre>
<p><em>Executioners</em> are a standard MOOSE feature that are well documented on
the <a href="http://www.mooseframework.com">MOOSE website</a>, so no further detail
is provided here.</p>
<h3 id="preconditioning">Preconditioning</h3>
<p>A default preconditioning block is used that provides all Jacobian
entries to aid convergence. This is identical for both 2D and 3D models:</p>
<pre><code>[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]
</code></pre>
<p>This is a standard MOOSE feature that is documented on the <a href="http://www.mooseframework.com">MOOSE
website</a>, so no further detail is
provided here.</p>
<h3 id="outputs">Outputs</h3>
<p>To provide ouptut from the simulation, an <em>Outputs</em> block must be
specified. An example is</p>
<pre><code>[Outputs]
  [./console]
    type = Console
    perf_log = true
    output_nonlinear = true
  [../]
  [./exodus]
    type = Exodus
    file_base = filename
    execute_on = 'INITIAL TIMESTEP_END FINAL'
  [../]
[]
</code></pre>
<p>In this case, some output regarding the iterations is streamed to the
console, while the results are provided in an Exodus file named
<em>filename.e</em>. There are a large number of output options available in
MOOSE, see the <a href="http://www.mooseframework.com">MOOSE website</a> for
further details.</p>
<h2 id="optional-input">Optional input</h2>
<p>While the above required blocks will enable a Numbat simulation to run,
there are a number of optional input blocks that will improve the
simulations are increase the amount of rsults provided.</p>
<h3 id="mesh-adaptivity">Mesh adaptivity</h3>
<p>MOOSE features built-in mesh adaptivity that is extremely useful in
Numbat simulations. This can be included using:</p>
<pre><code>[Adaptivity]
  marker = combomarker
  max_h_level = 2
  initial_marker = boxmarker
  initial_steps = 1
  [./Indicators]
    [./gradjumpindicator]
      type = GradientJumpIndicator
      variable = concentration
    [../]
  [../]
  [./Markers]
    [./errormarker]
      type = ErrorToleranceMarker
      coarsen = 0.0025
      refine = 0.005
      indicator = gradjumpindicator
    [../]
    [./boxmarker]
      type = BoxMarker
      bottom_left = '0 -1.0 0'
      top_right = '1000 0 0'
      inside = refine
      outside = dont_mark
    [../]
    [./combomarker]
      type = ComboMarker
      markers = 'boxmarker errormarker'
    [../]
  [../]
[]
</code></pre>
<p>For details about mesh adaptivity, see the <a href="http://www.mooseframework.com">MOOSE
website</a>.</p>
<h3 id="flux-at-the-top-boundary">Flux at the top boundary</h3>
<p>The flux over the top boundary is of particular interest in many cases
(especially convective mixing of $\textrm{CO}_2$). This can be
calculated at each time step using a <em>Postprocessor</em>:</p>
<pre><code>[Postprocessors]
  [./boundaryfluxint]
    type = NumbatSideFlux
    variable = concentration
    boundary = top
  [../]
[]
</code></pre>
<p>The output of the <em>Postprocessor</em> can be saved to a <em>csv</em> file by
including the following additional sub-block in the <em>Outputs</em> block:</p>
<pre><code>[./csvoutput]
  type = CSV
  file_base = filename
  execute_on = 'INITIAL TIMESTEP_END FINAL'
[../]
</code></pre>
<h3 id="velocity-components">Velocity components</h3>
<p>The velocity components in the $x$ and $y$ directions (in 2D), and $x$,
$y$, and $z$ directions in 3D can be calculated using the auxiliary
system. These velocity components are calculated using the
streamfunction(s), see the governing equations for details.</p>
<p>In the 2D case, two auxiliary variables, $u$ and $w$, can be defined for
the horizontal and vertical velocity components, respectively.
Importantly, these auxiliary variables <strong>must</strong> have constant monomial
shape functions (these are referred to as <em>elemental</em> variables, as the
value is constant over each mesh element). This restriction is due to
the gradient of the streamfunction variable(s) being undefined for
<em>nodal</em> auxiliary variables (for example, those using linear Lagrange
shape functions). An example of the input syntax for the 2D case is</p>
<pre><code>[AuxVariables]
  [./u]
    order = CONSTANT
    family = MONOMIAL
  [../]
  [./w]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]
</code></pre>
<p>For the 3D case, there is an additional horizontal velocity component
(<em>v</em>), so the input syntax is</p>
<pre><code>[AuxVariables]
  [./u]
    order = CONSTANT
    family = MONOMIAL
  [../]
  [./v]
    order = CONSTANT
    family = MONOMIAL
  [../]
  [./w]
    order = CONSTANT
    family = MONOMIAL
  [../]
[]
</code></pre>
<p>The velocity components are calculated by <em>NumbatDarcyVelocitySF</em> AuxKernels,
one for each component. For the 2D case, the input syntax is</p>
<pre><code>[AuxKernels]
  [./uAux]
    type = NumbatDarcyVelocitySF
    variable = u
    component = x
    streamfunction_variable = streamfunction
  [../]
  [./wAux]
    type = NumbatDarcyVelocitySF
    variable = w
    component = y
    streamfunction_variable = streamfunction
  [../]
[]
</code></pre>
<p>For the 3D case, three AuxKernels are required. Note that both
streamfunction variables must be given, in the correct order ($x$ then
$y$). An example of the input syntax is</p>
<pre><code>[AuxKernels]
  [./uAux]
    type = NumbatDarcyVelocitySF
    variable = u
    component = x
    streamfunction_variable = 'streamfunctionx streamfunctiony'
  [../]
  [./vAux]
    type = NumbatDarcyVelocitySF
    variable = v
    component = y
    streamfunction_variable = 'streamfunctionx streamfunctiony'
  [../]
  [./wAux]
    type = NumbatDarcyVelocitySF
    variable = w
    component = z
    streamfunction_variable = 'streamfunctionx streamfunctiony'
  [../]
[]
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../example2D/" class="btn btn-neutral float-right" title="2D example">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../governing-equations/" class="btn btn-neutral" title="Theory"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2016 Chris Green (chris.green@csiro.au)</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/cpgr/numbat/" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../governing-equations/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../example2D/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
