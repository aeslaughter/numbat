<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../../js/search_index.js" type="text/javascript"></script><script src="../../js/init.js" type="text/javascript"></script><title>Memory   Logger|Numbat</title><script src="../../contrib/plotly/plotly.min.js" type="text/javascript"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../../media/github-logo.png" class="github-mark"></img><img src="../../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="dd9bb6a4-c3c2-4843-8698-51f9d7b6c84a">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="1b91a117-dea2-4fee-995d-a16c561f8e1c">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="a27e32f2-c734-4692-b5e9-5e1692b13cc4">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="38d76d07-2f4f-4542-983d-2f0d1d95ba83">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="0b14035e-edd2-4155-a9df-96f7e034eb7c">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="dd9bb6a4-c3c2-4843-8698-51f9d7b6c84a"><li><a href="../../getting_started.html">Installation</a></li></ul><ul class="dropdown-content" id="1b91a117-dea2-4fee-995d-a16c561f8e1c"><li><a href="../../introduction.html">Introduction</a></li><li><a href="../../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="a27e32f2-c734-4692-b5e9-5e1692b13cc4"><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../input_file_syntax.html">Input file syntax</a></li><li><a href="../../running_numbat.html">Running Numbat</a></li><li><a href="../../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="38d76d07-2f4f-4542-983d-2f0d1d95ba83"><li><a href="../../example2D.html">2D</a></li><li><a href="../../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="0b14035e-edd2-4155-a9df-96f7e034eb7c"><li><a href="../../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">utilities</span><a href="." class="breadcrumb">python</a><a href="memory_logger.html" class="breadcrumb">memory_logger</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="Memory   Logger" data-section-level="1" id="fd432057-a30f-4ad4-8155-49c11f657ad2"><h1>Memory Logger</h1><p>Memory Logger is a simple tool for gathering information about a running process. Such things as memory usage, stdout and stack traces can be sampled, either on a single process or on multiple nodes in a job scheduling environment. Currently PBS is the only job scheduling system supported.</p><section class="scrollspy" data-section-text="Basic   usage" data-section-level="2" id="9a661797-8eb7-4ff5-b554-967dc2bdde0e"><h2>Basic usage</h2><p>In its simplest use case scenario, you encapsulate the command you would normally run with out Memory Logger as an argument to Memory Logger:</p><pre><code class="language-text">
memory_logger.py --run &quot;mpiexec -n 2 /absolute/path/to/moose_test-opt -i simple_diffusion.i -r 5&quot;
```
!alert note
Always use absolute paths between those --run double quotes. Memory Logger has no knowledge on paths
like: '../../ or ~/some/path'

Memory Logger will launch your process as normal, and begin to track the two processes that
launched. When Memory Logger detects that the process/s has exited (for good or for ill), it will
explain where the log was saved. You can then instruct Memory Logger to open this file, and display
its information either using Matplotlib (--plot), or by formatting the information and outputting it
to stdout (--read).

The items displayed are self-explanatory except perhaps for the percentage. The percentage is the
current percent of memory used at this point in time out of the total that will be consumed. This is
a post processing technique on the log file itself.

If we wanted, we can ask memory_logger to increase its sample rate to obtain more accurate usage:

```text
memory_logger.py  --repeat-rate .01 \
--run &quot;mpiexec -n 2 /absolute/path/to/moose_test-opt -i simple_diffusion.i -r 5&quot;
</code></pre><p>Okay... A bit too accurate, as several samples remained unchanged during tracking. However sometimes more is desirable, though just not printed in this fashion. For data dumps like this, using Matplotlib is far more efficient.</p></section><section class="scrollspy" data-section-text="Using   Matplotlib" data-section-level="2" id="cd3e6070-332d-4e24-bc6d-60d7164cb4fc"><h2>Using Matplotlib</h2><div style="width:300px;float:right;" id="memory-logger-example" class="card"><div class="card-image"><img src="../../media/memory_logger-plot_multi.png" class="materialboxed moose-image"></img><p class="moose-caption"><span class="moose-caption-heading">Figure 1: </span><span class="moose-caption-text">Example memory logger plot.</span></p></div></div><p>We can visualize the results by plotting the data with Matplotlib (<a class="tooltipped" href="#memory-logger-example" data-tooltip="#memory-logger-example" data-position="top">Figure 1</a>):</p><pre><code class="language-text">
memory_logger.py --plot simple_diffusion-r4_memory.log simple_diffusion-r6_repeat-rate0.01_memory.log
</code></pre><p>We can render multiple logs simultaneously to allow an easy comparison.</p></section><section class="scrollspy" data-section-text="Tracking   PBS   jobs" data-section-level="2" id="8c6d5a14-f941-4db2-9aa2-ae5acd02e14b"><h2>Tracking PBS jobs</h2><p>Memory Logger has the ability to track your processes across multiple nodes. In order for this to work correctly, we must launch an interactive job (qsub -I). The reason for this, is we can not have PBS launch a bunch of memory_loggers all in the same fashion... Instead we need one memory_logger, acting as the server, while a bunch of others acting as agents gathering data. The only thing we need to do is provide the &ndash;pbs argument.</p><pre><code class="language-text">
headnode #&gt; qsub -I

node #&gt; memory_logger.py --pbs \
--run &quot;mpiexec /absolute/path/to/moose_test-opt -i simple_diffusion.i -r 5&quot;
</code></pre><p>When Memory Logger encounters a &ndash;pbs argument, it will look at the contents of your $PBS_NODEFILE, to determine what other machines will be used to process your job. Memory Logger will remote into these machines (SSH), and launch its own memory_logger process, instructing it, how to communicate back to the original memory_logger you launched interactively.</p></section><section class="scrollspy" data-section-text="Stack   Traces ,   Dark   Mode   and   other   cool   things" data-section-level="2" id="548d21f7-b372-42c2-9461-1f8945f0dc1b"><h2>Stack Traces, Dark Mode and other cool things</h2><p>Obtaining stack traces while tracking memory usage on a single machine or across PBS nodes is the key feature of this tool. In order to do so we need to supply an additional two arguments; <code>--pstack</code> and <code>--debugger gdb|lldb</code>. Memory Logger supports two debuggers for the purpose of obtaining a stack trace (gdb or lldb).</p><pre><code class="language-text">
memory_logger.py --pstack --debugger gdb \
--run &quot;mpiexec /absolute/path/to/moose_test-opt -i simple_diffusion.i -r 5&quot;
</code></pre><p>The &ndash;pstack argument is used for both tracking and plotting. It tells Memory Logger to actually display stack trace information (if available in the log file).</p><pre><code class="language-text">
memory_logger.py --pstack --plot simple_diffusion_memory.log
</code></pre><p>Stack traces are represented in the form of points along the Matplotlib line graph. Clicking on these dots will cause memory_logger.py to print the actual stack trace gleamed at that time to stdout. However, if you choose to display all this junk on the terminal, you can with &ndash;read:</p><pre><code class="language-text">
memory_logger.py --pstack --read simple_diffusion_memory.log
&lt;not going to paste this data here. I am telling ya, its pages and pages&gt;
</code></pre><p>You can also display stdout along the Matplotlib graph:</p><pre><code class="language-text">
memory_logger.py --pstack --stdout --plot simple_diffusion_memory.log
</code></pre><div style="width:300px;float:right;" class="card"><div class="card-image"><img src="../../media/memory_logger-darkmode.png" class="materialboxed moose-image"></img><p class="moose-caption"><span class="moose-caption-text">&ndash;darkmode</span></p></div></div><p>That white back ground to bright for you? Try dark mode:</p><pre><code class="language-text">
memory_logger.py --pstack \
--darkmode \
--plot simple_diffusion-r4_memory.log simple_diffusion-r6_repeat-rate0.01_memory.log
</code></pre></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a data-delay="1000" data-position="left" href="#9a661797-8eb7-4ff5-b554-967dc2bdde0e" class="tooltipped" data-tooltip="Basic   usage">Basic   usage</a></li><li><a data-delay="1000" data-position="left" href="#cd3e6070-332d-4e24-bc6d-60d7164cb4fc" class="tooltipped" data-tooltip="Using   Matplotlib">Using   Matplotlib</a></li><li><a data-delay="1000" data-position="left" href="#8c6d5a14-f941-4db2-9aa2-ae5acd02e14b" class="tooltipped" data-tooltip="Tracking   PBS   jobs">Tracking   PBS   jobs</a></li><li><a data-delay="1000" data-position="left" href="#548d21f7-b372-42c2-9461-1f8945f0dc1b" class="tooltipped" data-tooltip="Stack   Traces ,   Dark   Mode   and   other   cool   things">Stack   Traces ,   Dark   Mode   and   other   cool   things</a></li></ul></div></div></div></div></main></div></body></html>