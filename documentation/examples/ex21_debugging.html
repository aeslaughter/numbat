<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../../js/search_index.js" type="text/javascript"></script><script src="../../js/init.js" type="text/javascript"></script><title>Example   21 :   Debugging|Numbat</title></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../../media/github-logo.png" class="github-mark"></img><img src="../../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="85aca518-daf3-48c7-a08a-32fe0c1d6887">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="a3636f34-724e-498b-99ab-ca3fa92a6075">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="26818875-50a5-429e-9e38-e4f4eb02c89e">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="b576a0dc-90a6-4416-af2d-4dc45eca443c">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="7c639ff7-63c5-4470-9032-e0de8337b20e">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="85aca518-daf3-48c7-a08a-32fe0c1d6887"><li><a href="../../getting_started.html">Installation</a></li></ul><ul class="dropdown-content" id="a3636f34-724e-498b-99ab-ca3fa92a6075"><li><a href="../../introduction.html">Introduction</a></li><li><a href="../../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="26818875-50a5-429e-9e38-e4f4eb02c89e"><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../input_file_syntax.html">Input file syntax</a></li><li><a href="../../running_numbat.html">Running Numbat</a></li><li><a href="../../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="b576a0dc-90a6-4416-af2d-4dc45eca443c"><li><a href="../../example2D.html">2D</a></li><li><a href="../../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="7c639ff7-63c5-4470-9032-e0de8337b20e"><li><a href="../../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">documentation</span><span class="breadcrumb">examples</span><a href="ex21_debugging.html" class="breadcrumb">ex21_debugging</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="Example   21 :   Debugging" data-section-level="1" id="7d969586-9a9e-4933-90ff-d0177f74c723"><h1>Example 21: Debugging</h1><p>For a more in-depth discussion of debugging with MOOSE <a data-position="top" href="../application_development/debugging.html" class="tooltipped" data-tooltip="../application_development/debugging.html">see the Debugging Documentation</a></p><ul class="browser-default"><li><p>It's inevitable: at some point in your MOOSE application development career, you will create a bug. </p></li><li><p>Sometimes, print statements are sufficient to help you determine the cause of the error. </p></li><li><p>For more complex bugs, a debugger can be more effective than print statements in helping to pinpoint the problem. </p></li><li><p>Many debuggers exist: LLDB, GDB, Totalview, ddd, Intel Debugger, etc. </p></li><li><p>It's typically best to use a debugger that is associated with your compiler, if one is available. </p></li><li><p>Here we focus on LLDB/GDB since it is relatively simple to use and is included in the MOOSE binary redistributable package. </p></li><li><p>A "Segmentation fault," "Segfault," or "Signal 11" error denotes a memory bug (often array access out of bounds). </p></li><li><p>In your terminal you will see a message like:</p></li></ul><pre><code class="language-text">
Segmentation fault: 11`
</code></pre><ul class="browser-default"><li><p>A segfault is a "good" error to have, because a debugger can easily pinpoint the problem.</p></li></ul><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p></section><section data-section-text="Debugging   Example   Problem" data-section-level="1" id="48433f52-840c-4a2a-85b7-145be030be3f"><h1>Debugging Example Problem</h1><ul class="browser-default"><li><p>This example is similar to Example 3, except that a common error has been introduced. </p></li><li><p>In <code>ExampleDiffusion.h</code>, a <code>VariableValue</code> that should be declared as a reference is not: <code>const VariableValue _coupled_coef</code> </p></li><li><p>Not storing this as a reference will cause a <em></em>copy** of the <code>VariableValue</code> to be made. </p></li><li><p>That copy will never be resized, nor will it ever have values written to it. </p></li><li><p>Attempting to access that <code>VariableValue</code> results in a segfault when running in optimized mode:</p></li></ul><pre><code class="language-text">
Time Step  0, time = 0
                dt = 0

Time Step  1, time = 0.1
                dt = 0.1
Segmentation fault: 11
</code></pre><ul class="browser-default"><li><p>We can use a debugger to help us find the problem.</p></li></ul><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p></section><section data-section-text="Debug   Executable" data-section-level="1" id="41894f4f-f94e-4a77-98eb-babe32963016"><h1>Debug Executable</h1><ul class="browser-default"><li><p>To use a debugger with a MOOSE-based application, you must compile your application in something other than optimized mode (opt). We highly recommend debug (dbg) mode so that you'll get full line number information in your stack traces:</p></li></ul><pre><code class="language-text">
cd ~/projects/moose/examples/ex21_debugging
METHOD=dbg make -j8
</code></pre><ul class="browser-default"><li><p>You will now have a "debug version" of your application called <code>ex21-dbg</code>. </p></li><li><p>Next, you need to run your application using either GDB (gcc) or LLDB (clang):</p></li></ul><pre><code class="language-text">
gdb --args ./ex21-dbg -i ex21.i
</code></pre><pre><code class="language-text">
lldb -- ./ex21-dbg -i ex21.i
</code></pre><ul class="browser-default"><li><p>When using either of these tools, the command line arguments to the application appear after the <code>--</code> separator. </p></li><li><p>This will start debugger, load your executable, and leave you at the debugger command prompt.</p></li></ul><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p></section><section data-section-text="Using   GDB   or   LLDB" data-section-level="1" id="ac5c0aab-cf0e-4517-9b6b-689a605e88e4"><h1>Using GDB or LLDB</h1><ul class="browser-default"><li><p>At any prompt in GDB or LLDB, you can type <code>h</code> and hit enter to get help. </p></li><li><p>We set a "breakpoint" in <code>MPI_Abort</code> so that the code pauses (maintaining the stack trace) before exiting.</p></li></ul><pre><code class="language-text">
b MPI_Abort
</code></pre><ul class="browser-default"><li><p>To run your application, type <code>r</code> and hit enter. </p></li><li><p>If your application hits the breakpoint in <code>MPI_Abort</code> you know it has crashed. </p></li><li><p>Type <code>where</code> (or <code>bt</code>) to see a backtrace.</p></li></ul><pre><code class="language-text">
    frame #0: 0x0000000106b14a20 libmpi.12.dylib`MPI_Abort
    frame #1: 0x00000001000d8e78 libex21-dbg.0.dylib`MooseArray&lt;double&gt;::operator[](this=0x0000000108852680, i=0) const + 2200 at MooseArray.h:267
    frame #2: 0x00000001000d85ab libex21-dbg.0.dylib`ExampleDiffusion::computeQpResidual(this=0x0000000108852000) + 43 at ExampleDiffusion.C:40
    frame #3: 0x0000000100c2affb libmoose-dbg.0.dylib`Kernel::computeResidual(this=0x0000000108852000) + 443 at Kernel.C:57
.....
</code></pre><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p><ul class="browser-default"><li><p>This backtrace shows that, in <code>ExampleDiffusion::computeQpResidual()</code> we tried to access entry 0 of a <code>MooseArray</code> with 0 entries. </p></li><li><p>If we look at the relevant line of code, we'll see:</p></li></ul><pre><code class="language-C++">
return _coupled_coef[_qp]*Diffusion::computeQpResidual();
</code></pre><ul class="browser-default"><li><p>There is only one thing we're indexing into on that line: <code>_coupled_coef</code>. </p></li><li><p>Therefore, we can look at how <code>_coupled_coef</code> was declared, realize that we forgot an ampersand (<code>&amp;</code>), and fix it!</p></li></ul><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p></section><section data-section-text="Example   21   Source   Code" data-section-level="1" id="0ada6551-893f-482a-86a6-90d1ede50992"><h1>Example 21 Source Code</h1><p><a href="https://github.com/idaholab/moose/blob/devel/examples/ex21_debugging/ex21.i" data-tooltip="https://github.com/idaholab/moose/blob/devel/examples/ex21_debugging/ex21.i" data-position="top" class="tooltipped">ex21.i</a></p><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p><p><a href="https://github.com/idaholab/moose/blob/devel/examples/ex21_debugging/include/kernels/ExampleDiffusion.h" data-tooltip="https://github.com/idaholab/moose/blob/devel/examples/ex21_debugging/include/kernels/ExampleDiffusion.h" data-position="top" class="tooltipped">ExampleDiffusion.h</a></p><p><a href="---" data-tooltip="---" data-position="top" class="tooltipped"></a></p><p><a href="https://github.com/idaholab/moose/blob/devel/examples/ex21_debugging/src/kernels/ExampleDiffusion.C" data-tooltip="https://github.com/idaholab/moose/blob/devel/examples/ex21_debugging/src/kernels/ExampleDiffusion.C" data-position="top" class="tooltipped">ExampleDiffusion.C</a></p></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"></ul></div></div></div></div></main></div></body></html>