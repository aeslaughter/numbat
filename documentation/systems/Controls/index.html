<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../../../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../../../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../../../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../../../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../../../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../../../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../../../js/search_index.js" type="text/javascript"></script><script src="../../../js/init.js" type="text/javascript"></script><title>Controls   System|Numbat</title></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../../../media/github-logo.png" class="github-mark"></img><img src="../../../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="143e1d86-c50f-48ad-afc2-77f2eaf8db8d">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="56d216f8-8aa7-4c1a-bf60-2dace25822c1">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="908cdae2-ff28-4d7f-940e-962f91e5ce3d">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="35f1c135-dd7a-4c69-812d-e546a66645b2">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="55664062-b8f7-4edb-ab93-5cc54472d0e0">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="143e1d86-c50f-48ad-afc2-77f2eaf8db8d"><li><a href="../../../getting_started.html">Installation</a></li></ul><ul class="dropdown-content" id="56d216f8-8aa7-4c1a-bf60-2dace25822c1"><li><a href="../../../introduction.html">Introduction</a></li><li><a href="../../../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="908cdae2-ff28-4d7f-940e-962f91e5ce3d"><li><a href="../../../implementation.html">Implementation</a></li><li><a href="../../../input_file_syntax.html">Input file syntax</a></li><li><a href="../../../running_numbat.html">Running Numbat</a></li><li><a href="../../../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="35f1c135-dd7a-4c69-812d-e546a66645b2"><li><a href="../../../example2D.html">2D</a></li><li><a href="../../../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="55664062-b8f7-4edb-ab93-5cc54472d0e0"><li><a href="../../../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">documentation</span><a href=".." class="breadcrumb">systems</a><a href="." class="breadcrumb">Controls</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="Controls   System" data-section-level="1" id="14f1d56e-5c5d-4139-a5c2-8caa610cb922"><h1>Controls System</h1><p>The control system in MOOSE has one primary purpose: <strong>to modify input parameters during runtime of a MOOSE-based simulation</strong>.</p><section class="section scrollspy" data-section-text="Creating   a   Controllable   Parameter" data-section-level="2" id="b3fcdf58-2840-4d57-b227-9414e1b361bf"><h2>Creating a Controllable Parameter</h2><p>The input parameters of objects you which to be controlled must:</p><ul class="browser-default"><li><p>Store parameter as a <code>const</code> reference; in your *.h files, declare storage for the parameters as follows.</p><div class="card"><div class="card-content"><pre style="max-height:350px;"><code class="language-cpp">  const Real &amp; _value;</code></pre><a data-position="top" href="#c154425f-6f07-4b5a-8336-0323b0edc719" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/framework/include/bcs/DirichletBC.h">(../moose/framework/include/bcs/DirichletBC.h)</a></div></div><p></p></li><li><p>Initialize the reference in the *.C file as follows.</p><div class="card"><div class="card-content"><pre style="max-height:350px;"><code class="language-cpp">  : NodalBC(parameters), _value(getParam&lt;Real&gt;(&quot;value&quot;))</code></pre><a data-position="top" href="#31f9ad14-9ee8-4300-8c99-5ecfb627ee73" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/framework/src/bcs/DirichletBC.C">(../moose/framework/src/bcs/DirichletBC.C)</a></div></div></li></ul><p>In order to "control" a parameter it must be communicated that the parameter is allowed to be controlled, this is done in the <code>validParams</code> function as in <a class="tooltipped" href="#declare_controllable" data-tooltip="#declare_controllable" data-position="top">Listing 1</a>. The input can be a single value or a space separated list of parameters.</p><div class="card"><div class="card-content"><p class="moose-caption"><span class="moose-caption-heading">Listing 1: </span><span class="moose-caption-text">Example <code>validParams</code> method that declares a parameter as controllable.</span></p><pre style="max-height:350px;"><code class="language-cpp">template &lt;&gt;
InputParameters
validParams&lt;DirichletBC&gt;()
{
  InputParameters p = validParams&lt;NodalBC&gt;();
  p.addRequiredParam&lt;Real&gt;(&quot;value&quot;, &quot;Value of the BC&quot;);
  p.declareControllable(&quot;value&quot;);
  p.addClassDescription(&quot;Imposes the essential boundary condition $u=g$, where $g$ &quot;
                        &quot;is a constant, controllable value.&quot;);
  return p;
}</code></pre><a data-position="top" href="#d748fdac-9965-45de-ac2c-9f38d8f7c8e0" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/framework/src/bcs/DirichletBC.C">(../moose/framework/src/bcs/DirichletBC.C)</a></div></div><div class="card moose-alert moose-alert-note"><div class="card-content"><div class="moose-alert-title card-title"><span class="moose-alert-title-brand">note</span></div><div class="moose-alert-content"><p>The <code>declareControllable</code> method also accepts a space separated list of parameters.</p></div></div></div></section><section class="section scrollspy" data-section-text="Create   a   Control   object" data-section-level="2" id="0360ec02-b8f8-4818-a933-d6af2719063f"><h2>Create a Control object</h2><p><code>Control</code> objects are similar to other systems in MOOSE. You create a control in your application by inheriting from the <code>Control</code> C++ class in MOOSE. It is required to override the <code>execute</code> method in your custom object. Within this method the following methods are generally used to get or set controllable parameters:</p><ul class="browser-default"><li><p><code>getControllableValue</code> <br> This method returns the current controllable parameter, in the case that multiple parameters are being controlled, only the first value will be returned and a warning will be produced if the values are differ (this warning may be disabled).</p><p></p></li><li><p><code>setControllableValue</code> <br> This method allows for a controllable parameter to be changed, in the case that multiple parameters are being controlled, all of the values will be set.</p></li></ul><p>These methods operator in a similar fashion as other systems in <a class="tooltipped" href="http://www.mooseframework.org" data-tooltip="http://www.mooseframework.org" data-position="top">MOOSE</a> (e.g., <code>getPostprocessorValue</code> in the <a class="tooltipped" href="systems/Postprocessors/index.md" data-tooltip="systems/Postprocessors/index.md" data-position="top">Postprocessors</a> system), each expects an input parameter name (<code>std::string</code>) that is prescribed in the <code>validParams</code> method.</p><p>There are additional overloaded methods that allow for the setting and getting of controllable values with various inputs for prescribing the parameter name, but the the two listed above are generally what is needed. Please refer to the source code for a complete list.</p></section><section class="section scrollspy" data-section-text="Controls   Block" data-section-level="2" id="d32fcb0d-abd1-4965-891d-064aa0dc1301"><h2>Controls Block</h2><p><code>Control</code> objects are defined in the input file in the Controls block, similar to other systems in <a class="tooltipped" href="http://www.mooseframework.org" data-tooltip="http://www.mooseframework.org" data-position="top">MOOSE</a>. For example, the following input file snippet shows the use of the <a data-position="top" href="RealFunctionControl.html" class="tooltipped" data-tooltip="RealFunctionControl.html">RealFunctionControl</a> object.</p><div class="card"><div class="card-content"><p class="moose-caption"><span class="moose-caption-heading">Listing 2: </span><span class="moose-caption-text">Example of a Control object used in a <a class="tooltipped" href="http://www.mooseframework.org" data-tooltip="http://www.mooseframework.org" data-position="top">MOOSE</a> input file.</span></p><pre style="max-height:350px;"><code class="language-text">
[Controls]
  [./func_control]
    type = RealFunctionControl
    parameter = '*/*/coef'
    function = 'func_coef'
    execute_on = 'initial timestep_begin'
  [../]
[]</code></pre><a data-position="top" href="#69381533-b873-43df-ba97-1ce2ff0d903c" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/test/tests/controls/real_function_control/real_function_control.i">(../moose/test/tests/controls/real_function_control/real_function_control.i)</a></div></div></section><section class="section scrollspy" data-section-text="Object   and   Parameter   Names" data-section-level="2" id="31b6c71a-3704-481b-8ff3-73351e34ab39"><h2 id="object-and-parameter-names">Object and Parameter Names</h2><p>Notice that in <a class="tooltipped" href="#controls_example" data-tooltip="#controls_example" data-position="top">Listing 2</a> the syntax for specifying a parameter is shown. In general, the syntax for a parameter name is specified as: <code>block/object/name</code>.</p><ul class="browser-default"><li><p><strong><code>block</code></strong>: specifies the input file block name (e.g., "<a class="tooltipped" href="systems/Kernels/index.md" data-tooltip="systems/Kernels/index.md" data-position="top">Kernels</a>", "<a class="tooltipped" href="systems/BCs/index.md" data-tooltip="systems/BCs/index.md" data-position="top">BCs</a>"). </p></li><li><p><strong><code>object</code></strong>: specifies the input file sub-block name (e.g., "diff" in <a class="tooltipped" href="#controls_example2" data-tooltip="#controls_example2" data-position="top">Listing 3</a>). </p></li><li><p><strong><code>name</code></strong>: specifies the parameter name (e.g., "coef" in <a class="tooltipped" href="#controls_example2" data-tooltip="#controls_example2" data-position="top">Listing 3</a>).</p></li></ul><div class="card"><div class="card-content"><p class="moose-caption"><span class="moose-caption-heading">Listing 3: </span><span class="moose-caption-text">Example of a "Kernel" block that contains a parameter that is controlled via a <a class="tooltipped" href="http://www.mooseframework.org" data-tooltip="http://www.mooseframework.org" data-position="top">MOOSE</a> Control object.</span></p><pre style="max-height:350px;"><code class="language-text">
[Kernels]
  [./diff]
    type = CoefDiffusion
    variable = u
    coef = 0.1
  [../]
  [./time]
    type = TimeDerivative
    variable = u
  [../]
[]</code></pre><a data-position="top" href="#991de662-0a37-4f74-a344-9a86df000552" class="tooltipped modal-trigger" data-tooltip="/Users/gre462/Documents/MOOSE/projects/moose/test/tests/controls/real_function_control/real_function_control.i">(../moose/test/tests/controls/real_function_control/real_function_control.i)</a></div></div><p>As shown in <a class="tooltipped" href="#controls_example" data-tooltip="#controls_example" data-position="top">Listing 2</a> an asterisk ("*") can be substituted for any one of these three "names", doing so allows multiple parameters to match and be controlled simultaneously.</p><p>In similar fashion, object names can be defined (e.g., as in the <a data-position="top" href="TimePeriod.html" class="tooltipped" data-tooltip="TimePeriod.html"><code>TimePeriod</code></a>) object. In this case, the general name scheme is the same as above but the parameter name is not included.</p><p>In both cases there is an alternative form for defining an object and parameter names: <code>base::object/name</code>. In this case "base" is the <a class="tooltipped" href="http://www.mooseframework.org" data-tooltip="http://www.mooseframework.org" data-position="top">MOOSE</a> base system that the object is derived from. For example, <code>Kernel::diff/coef</code>.</p></section><section class="section scrollspy" data-section-text="Child   Objects" data-section-level="2" id="a7ee8179-bb2f-44b1-9c11-34d08190ae0d"><h2>Child Objects</h2><ul class="collection with-header"><li class="moose-syntax-objects collection-item"><a href="RealFunctionControl.html" class="moose-syntax-objects-name">RealFunctionControl</a><span class="moose-syntax-objects-description">Sets the value of a 'Real' input parameters to the value of a provided function.</span></li><li class="moose-syntax-objects collection-item"><a href="TimePeriod.html" class="moose-syntax-objects-name">TimePeriod</a><span class="moose-syntax-objects-description">Control the enabled/disabled state of objects with time.</span></li></ul></section><section class="section scrollspy" data-section-text="Associated   Actions" data-section-level="2" id="04b72eb3-7238-49a6-89f1-8846d7cb633a"><h2>Associated Actions</h2><ul class="collection with-header"><li class="moose-syntax-actions collection-item"><a href="AddControlAction.html" class="moose-syntax-actions-name">AddControlAction</a></li></ul></section></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a data-delay="1000" data-position="left" href="#b3fcdf58-2840-4d57-b227-9414e1b361bf" class="tooltipped" data-tooltip="Creating   a   Controllable   Parameter">Creating   a   Controllable   Parameter</a></li><li><a data-delay="1000" data-position="left" href="#0360ec02-b8f8-4818-a933-d6af2719063f" class="tooltipped" data-tooltip="Create   a   Control   object">Create   a   Control   object</a></li><li><a data-delay="1000" data-position="left" href="#d32fcb0d-abd1-4965-891d-064aa0dc1301" class="tooltipped" data-tooltip="Controls   Block">Controls   Block</a></li><li><a data-delay="1000" data-position="left" href="#31b6c71a-3704-481b-8ff3-73351e34ab39" class="tooltipped" data-tooltip="Object   and   Parameter   Names">Object   and   Parameter   Names</a></li><li><a data-delay="1000" data-position="left" href="#a7ee8179-bb2f-44b1-9c11-34d08190ae0d" class="tooltipped" data-tooltip="Child   Objects">Child   Objects</a></li><li><a data-delay="1000" data-position="left" href="#04b72eb3-7238-49a6-89f1-8846d7cb633a" class="tooltipped" data-tooltip="Associated   Actions">Associated   Actions</a></li></ul></div></div></div></div></main></div><div id="c154425f-6f07-4b5a-8336-0323b0edc719" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/framework/include/bcs/DirichletBC.h</h4><pre><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#ifndef DIRICHLETBC_H
#define DIRICHLETBC_H

#include &quot;NodalBC.h&quot;

class DirichletBC;

template &lt;&gt;
InputParameters validParams&lt;DirichletBC&gt;();

/**
 * Boundary condition of a Dirichlet type
 *
 * Sets the value in the node
 */
class DirichletBC : public NodalBC
{
public:
  DirichletBC(const InputParameters &amp; parameters);

protected:
  virtual Real computeQpResidual() override;

  /// The value for this BC
  const Real &amp; _value;
};

#endif /* DIRICHLETBC_H */
</code></pre></div></div><div id="31f9ad14-9ee8-4300-8c99-5ecfb627ee73" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/framework/src/bcs/DirichletBC.C</h4><pre><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;DirichletBC.h&quot;

registerMooseObject(&quot;MooseApp&quot;, DirichletBC);

template &lt;&gt;
InputParameters
validParams&lt;DirichletBC&gt;()
{
  InputParameters p = validParams&lt;NodalBC&gt;();
  p.addRequiredParam&lt;Real&gt;(&quot;value&quot;, &quot;Value of the BC&quot;);
  p.declareControllable(&quot;value&quot;);
  p.addClassDescription(&quot;Imposes the essential boundary condition $u=g$, where $g$ &quot;
                        &quot;is a constant, controllable value.&quot;);
  return p;
}

DirichletBC::DirichletBC(const InputParameters &amp; parameters)
  : NodalBC(parameters), _value(getParam&lt;Real&gt;(&quot;value&quot;))
{
}

Real
DirichletBC::computeQpResidual()
{
  return _u[_qp] - _value;
}
</code></pre></div></div><div id="d748fdac-9965-45de-ac2c-9f38d8f7c8e0" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/framework/src/bcs/DirichletBC.C</h4><pre><code class="language-cpp">// This file is part of the MOOSE framework
// https://www.mooseframework.org
//
// All rights reserved, see COPYRIGHT for full restrictions
// https://github.com/idaholab/moose/blob/master/COPYRIGHT
//
// Licensed under LGPL 2.1, please see LICENSE for details
// https://www.gnu.org/licenses/lgpl-2.1.html

#include &quot;DirichletBC.h&quot;

registerMooseObject(&quot;MooseApp&quot;, DirichletBC);

template &lt;&gt;
InputParameters
validParams&lt;DirichletBC&gt;()
{
  InputParameters p = validParams&lt;NodalBC&gt;();
  p.addRequiredParam&lt;Real&gt;(&quot;value&quot;, &quot;Value of the BC&quot;);
  p.declareControllable(&quot;value&quot;);
  p.addClassDescription(&quot;Imposes the essential boundary condition $u=g$, where $g$ &quot;
                        &quot;is a constant, controllable value.&quot;);
  return p;
}

DirichletBC::DirichletBC(const InputParameters &amp; parameters)
  : NodalBC(parameters), _value(getParam&lt;Real&gt;(&quot;value&quot;))
{
}

Real
DirichletBC::computeQpResidual()
{
  return _u[_qp] - _value;
}
</code></pre></div></div><div id="69381533-b873-43df-ba97-1ce2ff0d903c" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/test/tests/controls/real_function_control/real_function_control.i</h4><pre><code class="language-text">###########################################################
# This is a test of the Control Logic System. This test
# uses the RealFunctionControl to change a Kernel
# coefficient based on an analytical function at the end
# of each timestep.
#
# @Requirement F8.10
###########################################################


[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 10
  ny = 10
[]

[Variables]
  [./u]
  [../]
[]

[Kernels]
  [./diff]
    type = CoefDiffusion
    variable = u
    coef = 0.1
  [../]
  [./time]
    type = TimeDerivative
    variable = u
  [../]
[]

[BCs]
  [./left]
    type = DirichletBC
    variable = u
    boundary = left
    value = 0
  [../]
  [./right]
    type = DirichletBC
    variable = u
    boundary = right
    value = 1
  [../]
[]

[Executioner]
  type = Transient
  num_steps = 10
  dt = 0.1
  dtmin = 0.1
  solve_type = PJFNK
  petsc_options_iname = '-pc_type -pc_hypre_type'
  petsc_options_value = 'hypre boomeramg'
[]

[Outputs]
  csv = true
[]

[Functions]
  [./func_coef]
    type = ParsedFunction
    value = '2*t + 0.1'
  [../]
[]

[Postprocessors]
  [./coef]
    type = RealControlParameterReporter
    parameter = 'Kernels/diff/coef'
  [../]
[]

[Controls]
  [./func_control]
    type = RealFunctionControl
    parameter = '*/*/coef'
    function = 'func_coef'
    execute_on = 'initial timestep_begin'
  [../]
[]
</code></pre></div></div><div id="991de662-0a37-4f74-a344-9a86df000552" class="modal bottom-sheet"><div class="modal-content"><h4>/Users/gre462/Documents/MOOSE/projects/moose/test/tests/controls/real_function_control/real_function_control.i</h4><pre><code class="language-text">###########################################################
# This is a test of the Control Logic System. This test
# uses the RealFunctionControl to change a Kernel
# coefficient based on an analytical function at the end
# of each timestep.
#
# @Requirement F8.10
###########################################################


[Mesh]
  type = GeneratedMesh
  dim = 2
  nx = 10
  ny = 10
[]

[Variables]
  [./u]
  [../]
[]

[Kernels]
  [./diff]
    type = CoefDiffusion
    variable = u
    coef = 0.1
  [../]
  [./time]
    type = TimeDerivative
    variable = u
  [../]
[]

[BCs]
  [./left]
    type = DirichletBC
    variable = u
    boundary = left
    value = 0
  [../]
  [./right]
    type = DirichletBC
    variable = u
    boundary = right
    value = 1
  [../]
[]

[Executioner]
  type = Transient
  num_steps = 10
  dt = 0.1
  dtmin = 0.1
  solve_type = PJFNK
  petsc_options_iname = '-pc_type -pc_hypre_type'
  petsc_options_value = 'hypre boomeramg'
[]

[Outputs]
  csv = true
[]

[Functions]
  [./func_coef]
    type = ParsedFunction
    value = '2*t + 0.1'
  [../]
[]

[Postprocessors]
  [./coef]
    type = RealControlParameterReporter
    parameter = 'Kernels/diff/coef'
  [../]
[]

[Controls]
  [./func_control]
    type = RealFunctionControl
    parameter = '*/*/coef'
    function = 'func_coef'
    execute_on = 'initial timestep_begin'
  [../]
[]
</code></pre></div></div></body></html>