<!DOCTYPE html><html><head><meta charset="UTF-8"><link media="screen,projection" href="../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../css/moose.css" type="text/css" rel="stylesheet"></link><script src="../../contrib/jquery/jquery.min.js" type="text/javascript"></script><script src="../../contrib/materialize/materialize.min.js" type="text/javascript"></script><script src="../../contrib/clipboard/clipboard.min.js" type="text/javascript"></script><script src="../../contrib/prism/prism.min.js" type="text/javascript"></script><script src="../../contrib/katex/katex.min.js" type="text/javascript"></script><script src="../../contrib/fuse/fuse.min.js" type="text/javascript"></script><script src="../../js/search_index.js" type="text/javascript"></script><script src="../../js/init.js" type="text/javascript"></script><title>Jacobian   Definition|Numbat</title></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="https://github.com/cpgr/numbat" class="right"><img src="../../media/github-logo.png" class="github-mark"></img><img src="../../media/github-mark.png" class="github-logo"></img></a><a href="http://cpgr.github.io/numbat/" class="left moose-logo">Numbat</a><ul class="right hide-on-med-and-down" id="nav-mobile"><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="0b8f95c5-54f3-4f0e-a97e-a04015bc2c4c">Getting Started<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="6db58271-63dc-4f7c-b867-1a9851654511">Theory<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="acd73c70-7afd-4bb3-b002-a8bd8639b8b2">Details<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="2ea0ca35-8c9b-40cf-b8f3-3356f2f07319">Examples<i class="material-icons right">arrow_drop_down</i></a></li><li><a data-constrainWidth="false" href="#!" class="dropdown-button" data-activates="c4e965d8-1443-459e-b48d-5827b0e2f7fc">Manual<i class="material-icons right">arrow_drop_down</i></a></li></ul><ul class="dropdown-content" id="0b8f95c5-54f3-4f0e-a97e-a04015bc2c4c"><li><a href="../../getting_started.html">Installation</a></li></ul><ul class="dropdown-content" id="6db58271-63dc-4f7c-b867-1a9851654511"><li><a href="../../introduction.html">Introduction</a></li><li><a href="../../governing_equations.html">Governing equations</a></li></ul><ul class="dropdown-content" id="acd73c70-7afd-4bb3-b002-a8bd8639b8b2"><li><a href="../../implementation.html">Implementation</a></li><li><a href="../../input_file_syntax.html">Input file syntax</a></li><li><a href="../../running_numbat.html">Running Numbat</a></li><li><a href="../../systems.html">Available objects</a></li></ul><ul class="dropdown-content" id="2ea0ca35-8c9b-40cf-b8f3-3356f2f07319"><li><a href="../../example2D.html">2D</a></li><li><a href="../../example3D.html">3D</a></li></ul><ul class="dropdown-content" id="c4e965d8-1443-459e-b48d-5827b0e2f7fc"><li><a href="../../download.html">User manual</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input autocomplete="off" onkeyup="mooseSearch()" type="text" id="moose-search-box"><label for="search">http://cpgr.github.io/numbat/</label></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-action modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><span class="breadcrumb">documentation</span><a href="." class="breadcrumb">application_development</a><a href="jacobian_definition.html" class="breadcrumb">jacobian_definition</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><section data-section-text="Jacobian   Definition" data-section-level="1" id="59d7108b-b477-47b1-8c32-65615fde346d"><h1>Jacobian Definition</h1><p>Finite element shape functions are introduced in the documentation section <a data-position="top" href="../finite_element_concepts/shape_functions.html" class="tooltipped" data-tooltip="../finite_element_concepts/shape_functions.html">shape functions</a>. There we outline how our primary variables are summations of those shape functions multiplied by constant coefficients which are our degrees of freedom. In <a data-position="top" href="../finite_element_concepts/numerical_implementation.html" class="tooltipped" data-tooltip="../finite_element_concepts/numerical_implementation.html">numerical implementation</a> we give explicit illustration of how the derivative of a variable <code>u</code> with respect to its jth degree of freedom (<span class="moose-katex-inline-equation" id="moose-equation-b1e10eb4-f2c7-4c0c-8ae3-30876007d1a7"><script>var element = document.getElementById("moose-equation-b1e10eb4-f2c7-4c0c-8ae3-30876007d1a7");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-23f2ce05-2588-4777-8bbf-2548d2e4b8e8"><script>var element = document.getElementById("moose-equation-23f2ce05-2588-4777-8bbf-2548d2e4b8e8");katex.render("u_j", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-a8817a59-6fda-41fc-904f-605568398ce1"><script>var element = document.getElementById("moose-equation-a8817a59-6fda-41fc-904f-605568398ce1");katex.render("", element, {displayMode:false,throwOnError:false});</script></span>) is equal to the jth shape function <span class="moose-katex-inline-equation" id="moose-equation-761947f8-d9be-426b-ba34-e1287ee201bf"><script>var element = document.getElementById("moose-equation-761947f8-d9be-426b-ba34-e1287ee201bf");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-37e6747f-a9e5-4e61-b8ef-e7e8fa82060a"><script>var element = document.getElementById("moose-equation-37e6747f-a9e5-4e61-b8ef-e7e8fa82060a");katex.render("\\phi_j", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-13ff1d24-e1f4-4508-a80c-d645c6ec6288"><script>var element = document.getElementById("moose-equation-13ff1d24-e1f4-4508-a80c-d645c6ec6288");katex.render("", element, {displayMode:false,throwOnError:false});</script></span>. Similarly the derivative of <span class="moose-katex-inline-equation" id="moose-equation-233d9c88-fd97-4e67-af71-5549f3783d31"><script>var element = document.getElementById("moose-equation-233d9c88-fd97-4e67-af71-5549f3783d31");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-08d5da2a-25cc-4f16-a78f-30fae7d3c995"><script>var element = document.getElementById("moose-equation-08d5da2a-25cc-4f16-a78f-30fae7d3c995");katex.render("\\nabla u", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-9b9d6edc-db34-4874-9109-88b6c2d0c6d0"><script>var element = document.getElementById("moose-equation-9b9d6edc-db34-4874-9109-88b6c2d0c6d0");katex.render("", element, {displayMode:false,throwOnError:false});</script></span> with respect to <span class="moose-katex-inline-equation" id="moose-equation-56f3776b-166e-4ee9-b162-fb0a54c64e81"><script>var element = document.getElementById("moose-equation-56f3776b-166e-4ee9-b162-fb0a54c64e81");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-4472c14a-85c8-4cfe-a2c0-6b9fe32f04e6"><script>var element = document.getElementById("moose-equation-4472c14a-85c8-4cfe-a2c0-6b9fe32f04e6");katex.render("u_j", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-ff003642-935a-4452-8695-c6455e8e2041"><script>var element = document.getElementById("moose-equation-ff003642-935a-4452-8695-c6455e8e2041");katex.render("", element, {displayMode:false,throwOnError:false});</script></span> is equal to <span class="moose-katex-inline-equation" id="moose-equation-eca17c94-08ab-475c-8b86-e22118b7a349"><script>var element = document.getElementById("moose-equation-eca17c94-08ab-475c-8b86-e22118b7a349");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-546cadda-46d0-4283-8dbf-218c3b369020"><script>var element = document.getElementById("moose-equation-546cadda-46d0-4283-8dbf-218c3b369020");katex.render("\\nabla \\phi_j", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-6183eefd-5b42-42db-a31d-c7648d937aa9"><script>var element = document.getElementById("moose-equation-6183eefd-5b42-42db-a31d-c7648d937aa9");katex.render("", element, {displayMode:false,throwOnError:false});</script></span>. The code expression <code>_phi[_j][_qp]</code> represents <span class="moose-katex-inline-equation" id="moose-equation-f99296a6-26be-46d4-bb47-9d8d6e968ab8"><script>var element = document.getElementById("moose-equation-f99296a6-26be-46d4-bb47-9d8d6e968ab8");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-3315efc9-284f-4ce7-b586-bbc215c62e40"><script>var element = document.getElementById("moose-equation-3315efc9-284f-4ce7-b586-bbc215c62e40");katex.render("\\frac{\\partial u}{\\partial u_j}", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-23fffaba-0b33-4d76-99d0-c96d5d0d5b4a"><script>var element = document.getElementById("moose-equation-23fffaba-0b33-4d76-99d0-c96d5d0d5b4a");katex.render("", element, {displayMode:false,throwOnError:false});</script></span> in any MOOSE framework residual and Jacobian computing objects such as kernels and boundary conditions.</p><p>Any MOOSE kernel may have an arbitrary number of variables coupled into it. If these coupled variables use the same shape function family and order, then their associated <span class="moose-katex-inline-equation" id="moose-equation-2aae8599-b388-4a94-8c26-1949dbb7b16d"><script>var element = document.getElementById("moose-equation-2aae8599-b388-4a94-8c26-1949dbb7b16d");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-1ad60e75-576a-44fe-9147-c4a2acc95e70"><script>var element = document.getElementById("moose-equation-1ad60e75-576a-44fe-9147-c4a2acc95e70");katex.render("\\phi_j", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-d818bdd6-39e1-4a01-88dd-1af7a5bc6f34"><script>var element = document.getElementById("moose-equation-d818bdd6-39e1-4a01-88dd-1af7a5bc6f34");katex.render("", element, {displayMode:false,throwOnError:false});</script></span>s will be equivalent. However, if <code>u</code> and <code>v</code> use different shape functions then <span class="moose-katex-inline-equation" id="moose-equation-a1bc0f3d-b406-4068-a8f4-d774cb6e358a"><script>var element = document.getElementById("moose-equation-a1bc0f3d-b406-4068-a8f4-d774cb6e358a");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-7d540f42-62ee-4033-993a-2e79b23ccde6"><script>var element = document.getElementById("moose-equation-7d540f42-62ee-4033-993a-2e79b23ccde6");katex.render("\\phi_{j,u} \\ne \\phi_{j,v}", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-e01e4067-e232-4736-ae15-a91736b79951"><script>var element = document.getElementById("moose-equation-e01e4067-e232-4736-ae15-a91736b79951");katex.render("", element, {displayMode:false,throwOnError:false});</script></span>. As a developer, however, you do not <em></em><em>in most cases</em><em></em> have to worry about these differences in <span class="moose-katex-inline-equation" id="moose-equation-e2c142b6-2539-4bd2-b645-2bee0b7d6ff4"><script>var element = document.getElementById("moose-equation-e2c142b6-2539-4bd2-b645-2bee0b7d6ff4");katex.render("", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-4d55b7d7-36a8-4bd5-9bf4-52409a307f1e"><script>var element = document.getElementById("moose-equation-4d55b7d7-36a8-4bd5-9bf4-52409a307f1e");katex.render("\\phi", element, {displayMode:false,throwOnError:false});</script></span><span class="moose-katex-inline-equation" id="moose-equation-2855f267-8bb0-4186-a382-04193e33957e"><script>var element = document.getElementById("moose-equation-2855f267-8bb0-4186-a382-04193e33957e");katex.render("", element, {displayMode:false,throwOnError:false});</script></span>. MOOSE automatically updates the object member variable <code>_phi</code> to use the shape functions of the variable for whom the Jacobian is currently being computed. <em></em><em>However</em><em></em>, if the primary variable <code>u</code> is a scalar-valued (single-component) finite element variable and the coupled variable <code>v</code> is a vector-valued (multi-component) finite element variable (or visa versa), then you must introduce an additional member variable to represent the shape functions of the vector-valued (scalar-valued) variable. The name of this variable is up to the developer, but we suggest perhaps a <code>_standard_</code> prefix for scalar valued finite-element variables and <code>_vector_</code> for vector valued finite-element variables. The <code>_standard_</code> prefix is suggested over <code>_scalar_</code> so as not to be confused with a <code>MooseVariableScalar</code>, which only has a single value over the entire spatial domain. An example constructor for a standard kernel that couples in a vector-valued FE variable is shown below:</p><pre><code class="language-text">
EFieldAdvection::EFieldAdvection(const InputParameters &amp; parameters)
  : Kernel(parameters),
    _efield_id(coupled(&quot;efield&quot;)),
    _efield(coupledVectorValue(&quot;efield&quot;)),
    _efield_var(*getVectorVar(&quot;efield&quot;, 0)),
    _vector_phi(_assembly.phi(_efield_var)),
    _mobility(getParam&lt;Real&gt;(&quot;mobility&quot;))
{
}
</code></pre><p>The associated declarations are:</p><pre><code class="language-text">
  const unsigned int _efield_id;
  const VectorVariableValue &amp; _efield;
  VectorMooseVariable &amp; _efield_var;
  const VectorVariablePhiValue &amp; _vector_phi;
  const Real _mobility;
  Real _sgn;
</code></pre><p>Residual, on-diagonal, and off-diagonal methods are respectively</p><pre><code class="language-text">
Real
EFieldAdvection::computeQpResidual()
{
  return -_grad_test[_i][_qp] * _sgn * _mobility * _efield[_qp] * _u[_qp];
}
</code></pre><p>and</p><pre><code class="language-text">
Real
EFieldAdvection::computeQpJacobian()
{
  return -_grad_test[_i][_qp] * _sgn * _mobility * _efield[_qp] * _phi[_j][_qp];
}
</code></pre><p>and</p><pre><code class="language-text">
Real
EFieldAdvection::computeQpOffDiagJacobian(unsigned int jvar)
{
  if (jvar == _efield_id)
    return -_grad_test[_i][_qp] * _sgn * _mobility * _vector_phi[_j][_qp] * _u[_qp];
  else
    return 0;
}

```
An example constructor for a vector kernel that couples in a
scalar-valued FE variable is shown below:

```
VectorCoupledGradientTimeDerivative::VectorCoupledGradientTimeDerivative(
    const InputParameters &amp; parameters)
  : VectorKernel(parameters),
    _grad_v_dot(coupledGradientDot(&quot;v&quot;)),
    _d_grad_v_dot_dv(coupledDotDu(&quot;v&quot;)),
    _v_id(coupled(&quot;v&quot;)),
    _v_var(*getVar(&quot;v&quot;, 0)),
    _standard_grad_phi(_assembly.gradPhi(_v_var))
{
}

```
The associated declarations are:

```
  const VariableGradient &amp; _grad_v_dot;
  const VariableValue &amp; _d_grad_v_dot_dv;
  const unsigned _v_id;
  MooseVariable &amp; _v_var;
  const VariablePhiGradient &amp; _standard_grad_phi;
</code></pre><p>Residual and off-diagonal Jacobian methods are respectively:</p><pre><code class="language-text">
Real
VectorCoupledGradientTimeDerivative::computeQpResidual()
{
  return _test[_i][_qp] * _grad_v_dot[_qp];
}
</code></pre><p>and</p><pre><code class="language-text">
Real
VectorCoupledGradientTimeDerivative::computeQpOffDiagJacobian(unsigned jvar)
{
  if (jvar == _v_id)
    return _test[_i][_qp] * _d_grad_v_dot_dv[_qp] * _standard_grad_phi[_j][_qp];

  else
    return 0.;
}
</code></pre><div class="card moose-alert moose-alert-note"><div class="card-content"><div class="moose-alert-title card-title"><span class="moose-alert-title-brand">note:</span>Flexibility</div><div class="moose-alert-content"><p>Note that only one member is needed to represent shape functions for standard  <code>MooseVariable</code>s and <code>VectorMooseVariable</code>s. For example, if the vector-variables  <code>v</code> and <code>w</code> are coupled into a standard kernel for <code>u</code>, only a single  <code>_vector_phi</code> member needs to be added; there is not need for both a  <code>_v_phi</code> and <code>_w_phi</code>. <code>_vector_phi</code> will be automatically updated to  represent the shape functions for whichever vector variable the Jacobian is  being computed for.</p></div></div></div></section></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"></ul></div></div></div></div></main></div></body></html>