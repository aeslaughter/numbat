# Implementation details

## Rayleigh number

The Rayleigh number relates the relative importance of buoyancy forces to diffusive forces, and is an important dimensionless number in convection. [citet:slim2014] showed that increasing the Rayleigh number increases the number of
flow regimes that the convective mixing process goes through.

In the dimensionless model implemented in Numbat, the Rayleigh number appears in the vertical position of the bottom boundary only [citep:slim2014]. As a result, it is simple to vary the Rayleigh
number in the dimensionless model by simply extending the mesh in the vertical direction.

In the dimensional model, the Rayleigh number may be varied by changing the various physical parameters present, such as permeability, fluid viscosity etc.

## Mesh considerations

The process of density-driven convective mixing in porous media begins initially as diffusive mass transfer accross the interface between a saturated fluid lying atop an unsaturated fluid. After a sufficient time, the gravitational instability
grows until small downwelling fingers of saturated fluid desecend into the unsaturated fluid. As time continues, these fingers grow and merge, forming larger fingers. The temporal evolution of this process is shown in [fig:evolution]. The top image shows an initial diffusive profile. As time increases, fingers form, merge and grow in a complex manner.

!media media/evolution.png
       style=width:90%;margin:auto
       caption=Evolution of convective dissolution (time increasing downwards). Note that the scale is identical for all
       images.
       id=fig:evolution

It is apparent from the temporal evolution above that the mesh requirements differ in different regimes. Early on and near the top of the mesh, the elements must be sufficiently refined to capture the initial formation of small fingers. Later on, and away from the top boundary, larger elements may adequately capture the large downwelling fingers, and as such, the mesh may be coarser in this region.

There are two ways that the user may deal with these disparate mesh requirements: use a mesh that is more refined in the vicinity of the top boundary; or use adaptive mesh refinement. Both of these are possible in Numbat.

Numbat provides a type of [GeneratedMesh](/GeneratedMesh.md) where the elements are biased towards the top boundary, [NumbatBiasedMesh](/NumbatBiasedMesh.md), so that
it is more refined in the vicinity of the constant concentration boundary. This is particularly useful in two dimensions.

For three-dimensional models, an external meshing code may be used to generate an unstructured mesh. MOOSE can read a number of mesh formats natively, see the [MOOSE] documentation for details. One open-source option for generating unstructured meshes that MOOSE can read is [Gmsh](http://www.gmsh.info). An example of a fully unstructured 3D mesh that is refined near the top boundary and coarse near the bottom boundary is shown in [fig:unstructuredmesh].

!media media/unstructuredmesh.png
       style=width:100%;margin:auto
       caption=Example of unstructured mesh used in Numbat that was generated by Gmsh. Leftmose image shows small section
       near the top with the concentration profile at an early time; middle image shows top quarter of full mesh and concentration profile at an intermediate time; rightmost image shows full mesh and concentration profile at late time.
       id=fig:unstructuredmesh

## Seeding the perturbation

Numerical simulations of solutal convection rely on seeding the gravitational instability to initiate the convective mixing process. Numerical roundoff will eventually initiate convective mixing, but can significantly overestimate the critical time for the onset of convection.

Instead, it is usual to seed the instability using a prescribed random perturbation in the model. Several types of perturbation have been considered in the literature, see [citet:emami-meybodi2015] for a detailed review.

In Numbat, an initial perturbation to seed the instability can be applied in several ways:

- In the dimensional formulation, a random noise sampled from a uniform distribution can be applied to the porosity;
- In the dimensionless streamfunction formulation, an initial perturbation to the diffusive concentration profile can be applied;
- A random fluctuation to the concentration boundary condition can be applied.

The strength of the initial perturbation has been shown to affect the initial onset time for convection, see [citet:emami-meybodi2015] for details. This should be taken into consideration when modelling convective mixing in porous media.

!bibtex bibliography
